(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";!function(){const e=require("../modules/home/homeRecommendationsLoader"),t=require("../modules/home/homeBlocksLoaderWba/homeBlocksLoaderWba"),o=[{name:"hits",targetUrl:"MI",sizeForDynamicGoods:49,sizeForStaticGood:70,dataUrl:"/homeRecommendedGoods",analiticsCode:"MCS"},{name:"visited",targetUrl:"RG",sizeForDynamicGoods:49,sizeForStaticGood:14,dataUrl:"/webapi/goods/visited-nm",analiticsCode:"MCV"}],a=[{blockType:0,data:[],chunk:4,start:1,rows:3,bannerType:"sm",analiticsCode:"MBT"},{blockType:4,analticsCode:"",abTesting:{repurchaseCarousel:!0},canShow:!1},{blockType:1,data:{showTitle:!0,rowLength:7,startCardIndex:0,rowsCount:1,blockName:"hits",advertCount:1,advertPositions:[2],advIndex:0},analiticsCode:"MCS"},{blockType:0,data:[],chunk:4,start:4,rows:2,bannerType:"sm",analiticsCode:"MBG"},{blockType:1,data:{rowLength:7,startCardIndex:7,rowsCount:1,blockName:"hits",advertCount:1,advertPositions:[3],advIndex:1},analiticsCode:"MCS"},{blockType:0,data:[],chunk:2,start:1,rows:1,bannerType:"st",analiticsCode:"MBH"},{blockType:1,data:{rowLength:7,startCardIndex:14,rowsCount:2,blockName:"hits",advertCount:2,advertPositions:[1,4],advIndex:2},analiticsCode:"MCS"},{blockType:0,data:[],chunk:2,start:2,rows:1,bannerType:"st",analiticsCode:"MBH"},{blockType:3,analticsCode:""},{blockType:1,data:{rowLength:7,startCardIndex:28,rowsCount:1,blockName:"hits",advertCount:1,advertBoundaries:[1,2],advIndex:4},analiticsCode:"MCS"},{blockType:0,data:[],chunk:2,start:3,rows:1,bannerType:"st",analiticsCode:"MBH"},{blockType:1,data:{rowLength:7,startCardIndex:35,rowsCount:5,blockName:"hits",enableShowMoreBtn:!0,advertCount:5,advertBoundaries:[1,2],advIndex:5},analiticsCode:"MCS",abTesting:{addRows:!0}},{blockType:1,data:{showTitle:!0,rowLength:7,startCardIndex:0,rowsCount:2,blockName:"visited",enableShowMoreBtn:!0},analiticsCode:"MCV"}];let n=function(){function n(n){this.splitInfoTask=n.splitInfoTask,this.blocks=a,this._checkSplitterHomePageBlocks(),this._setBanners(n.bannersTask,n.banners),this.recommendationsLoaders=o.reduce((t,o)=>(t.set(o.name,e.create(o)),t),new Map),this.blocks.forEach(e=>{if(1===e.blockType){const t=this.recommendationsLoaders.get(e.data.blockName);e.data.id=btoa(this.$generateGuid()),t.addBlock(e.data)}}),this.canShowStories=wb.global.settings.switches.showWbStoriesOnMainPage,this.bottomTextOpened=!1,this.lazyLoader=null,this.needEvaluate=[],this.nowDate=(new Date).toLocaleDateString(),this.onDinamicCarouselRenderEvent=this.onDinamicCarouselRenderEvent.bind(this),this.loadStories=this.loadStories.bind(this),this.loadCarousel=this.loadCarousel.bind(this),this._onChangeDisplayMode=this._onChangeDisplayMode.bind(this),this.homeBlocksLoaderWba=new t}var s=n.prototype;return s._checkSplitterHomePageBlocks=async function(){const e=await this.splitInfoTask;if(e)if("mp_req_extended"!==e.title)if("mp_req_repurchase_block"!=e.title);else{const e=this.blocks.find(e=>{var t;return null===(t=e.abTesting)||void 0===t?void 0:t.repurchaseCarousel});e&&(e.canShow=!0)}else{const e=this.blocks.find(e=>{var t;return null===(t=e.abTesting)||void 0===t?void 0:t.addRows});e&&(this.recommendationsLoaders.get(e.data.blockName).blocks.get(e.data.id).addRowCount(4),e.data.rowsCount+=4)}},s.onBeforeRender=async function(){$.observe(wb.settings,"displayMode",this._onChangeDisplayMode)},s._onChangeDisplayMode=async function(){const e=await this.$services.bannersService.getBannersForHomePageAsync();$.observable(this).setProperty({mainBanners:e.mainBanners})},s.onAfterRender=async function(){this.loadCarousel(),document.addEventListener("DynamicCarouselRendered",this.onDinamicCarouselRenderEvent),this.recommendationsLoaders.forEach(e=>e.init());const e=this.$moduleLoader.loadModuleAsync("lazyImageLoader").then(e=>(this.lazyLoader=new e(document.documentElement),Promise.resolve()));this.promoBanners=this._initPromoBanner(),this._initSeo(),this.$stat.banners.sendStatisticNow(),this.$stat.banners.initClickEvent(),this.quickNavDestroyer=wb.quickNav({bottomPx:document.documentElement.clientHeight}),await Promise.all([e,this.recommendationsLazyLoader(e)]),this._updateLazyLoader(),this.homeBlocksLoaderWba.init(this.bannersReady),this._offerRateInit()},s.getScreenName=function(){return"Main"},s.onBeforeUnrender=function(){var e,t,o,a,n,s,i,r;$.unobserve(wb.settings,"displayMode",this._onChangeDisplayMode),document.removeEventListener("DynamicCarouselRendered",this.onDinamicCarouselRenderEvent),null===(e=this.quickNavDestroyer)||void 0===e||e.call(this),null===(t=this.lazyLoader)||void 0===t||t.destroy(),null===(o=this.promoBanners)||void 0===o||o.destroy(),null===(a=this.stories)||void 0===a||a.destroy(),this.$stat.banners.destroyClickEvent(),this.recommendationsLoaders.forEach(e=>{e.destroy()}),null===(n=this.recommendationsObserver)||void 0===n||n.destroy(),null===(s=this.verticalObserver)||void 0===s||s.destroy(),null===(i=this.repurchaseCarousel)||void 0===i||i.destroy(),null===(r=this.homeBlocksLoaderWba)||void 0===r||r.destroy()},s.onHistoryChange=function(){this._initSeo()},s.onDinamicCarouselRenderEvent=function(e){this._updateLazyLoader(),this.homeBlocksLoaderWba.addRecommendationBlock(e.detail)},s.renderCarousel=function(e){const{data:t}=$.view(e.currentTarget);if(!t)return;const o=this.recommendationsLoaders.get(t.data.blockName);o&&o.renderCarousel(t.data.id)},s.recommendationsLazyLoader=async function(e){const t=document.querySelectorAll(".j-goods-wrapper");if(navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.indexOf("Trident/")>0)return await e,t.forEach(e=>e.dispatchEvent(new CustomEvent("elementInViewportEvent",{bubbles:!0})));this.recommendationsObserver=this.$observerHelper.getVerticalObserver(t.toArray(),{rootMargin:"200px"}),this.recommendationsObserver.observe()},s.loadStories=async function(){if((await this.$user.getUserInfo()).isAuth){const e=await this.$moduleLoader.loadModuleAsync("wbStories");this.stories=new e(e.template),await this.stories.init(),this.homeBlocksLoaderWba.addStories(this.stories)}},s.loadCarousel=async function(){const e=document.querySelector(".j-carousel-wrapper");if(!e)return null;const{data:t}=$.view(e);if(!t.abTesting.repurchaseCarousel)return null;const o=await this.$moduleLoader.loadModuleAsync("recommendationsList",!1),a={loadItemsCustom:async function(){const e={goods:[]},t=await this.$analitic.getSplitterHeaders(),o=await this.$user.getUserInfo();if(!o.isAuth)return e;t["content-type"]="application/json";const a=await WbSpaModel.prototype.$httpClient.fetchBasicJSON(`https://repeated-goods.wildberries.ru/api/v1/repeated?id=${o.uid}`,{headers:t},{timeout:3e3,nullOnError:!0});if(!((null==a?void 0:a.length)>0))return e;const n=await wb.xnm.getGoodsForRecommendAndCatalog(a.slice(0,100),!1,!0);return(null==n?void 0:n.length)>6?(e.goods=n,e):e}.bind(this),loadTagInfo:!0,title:"Может пригодиться",analiticsCode:"MPF",needSendViewItemListStateWba:!0};this.repurchaseCarousel=await new o(e,a).showAsync()},s._setBanners=async function(e,t){const o=!t;o&&(t=await e),$.observable(this).setProperty({mainBanners:t.mainBanners}),this.blocks.forEach(e=>{var o,a;0==e.blockType&&("sm"===e.bannerType&&null!==(o=t.smallBanners)&&void 0!==o&&o.length&&$.observable(e).setProperty({data:this._buildBannerRows(t.smallBanners,e.chunk,e.start,e.rows)}),"st"===e.bannerType&&null!==(a=t.stripBanners)&&void 0!==a&&a.length&&$.observable(e).setProperty({data:this._buildBannerRows(t.stripBanners,e.chunk,e.start,e.rows)}))}),this._bannersShownStat(),this.bannersReady=!0,o&&(this._updateLazyLoader(),this.homeBlocksLoaderWba.bannersReady||(this.homeBlocksLoaderWba.bannersReady=!0,this.homeBlocksLoaderWba.updateBlocks()))},s._initSeo=async function(){var e;this.seoData=null!==(e=this.seoData)&&void 0!==e?e:await this.$httpClient.fetchJSON("/webapi/api/home/seo"),this.$seoHelper.render(this.seoData.metaTags),this.$setActionPayRetargetingModel(this.seoData.actionPayRetargetingModel),this.$setGoogleTagsModel(this.seoData.googleTagParamsModel),this.$observable.setProperty({bottomText:this.seoData.bottomText})},s._bannersShownStat=function(){this.verticalObserver=this.$stat.banners.bannerBlockShownStatWba(this)},s._offerRateInit=async function(){if(!(await this.$user.getUserInfo()).isAuth)return;const e=localStorage.getObject("offerRateMain");if(e&&e.date===this.nowDate)e.hide||0===e.products.length||this._loadOfferRate(e.products);else{const e=await this.$httpClient.fetchJSON("webapi/lk/myorders/goods/notevaluated",{method:"POST"}),t={date:this.nowDate,hide:!1,products:e};localStorage.putObject("offerRateMain",t),(null==e?void 0:e.length)>0&&this._loadOfferRate(e)}},s._loadOfferRate=function(e){this.$moduleLoader.loadModuleAsync("offerRateProducts").then(t=>{$.observable(this).setProperty({offerRate:new t(t.template)}),this.offerRate.init(e)})},s._initPromoBanner=function(){let e=[];const t=function(){if(window.innerWidth>1023)for(;e.length>0;){let t=e[0];null==t||t.destroy(!0,!0),e.splice(0,1)}else 0==e.length&&(e=o())},o=function(){var e=new Swiper(".j-promo-banners",{slidesPerView:1,loop:!0,effect:"fade",fadeEffect:{crossFade:!0},lazy:{loadPrevNext:!0},pagination:{el:".j-promo-banners-pagination",type:"bullets",dynamicBullets:!0,clickable:!0}});return e=Array.isArray(e)?e:[e]};return window.addEventListener("resize",t),t(),{destroy:function(){for(;e.length>0;){let t=e[0];t.initialized&&t.destroy(!0,!0),e.splice(0,1)}window.removeEventListener("resize",t)}}},s._updateLazyLoader=function(e){var t;null===(t=this.lazyLoader)||void 0===t||t.update(document.querySelectorAll("img[data-original], picture[data-original]").toArray(),e)},s._buildBannerRows=function(e,t,o,a){let n=[];for(let s=0;s<a;s++){let a=this._buildSingleBannersRow(e,t,o+s);null!==a&&n.push(a)}return n},s._buildSingleBannersRow=function(e,t,o){let a=(o-1)*t+1+500,n=e.filter(e=>e.placementOptions.sort>=a&&e.placementOptions.sort<a+t).reduce((e,t)=>((e[t.placementOptions.sort]=e[t[t.placementOptions.sort]]||[]).push(t),e),{}),s=Object.values(n);return s.length===t?s:null},n}();wb.spa.registerViewModel(n)}();

},{"../modules/home/homeBlocksLoaderWba/homeBlocksLoaderWba":2,"../modules/home/homeRecommendationsLoader":5}],2:[function(require,module,exports){
"use strict";function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}const HomeBlocksLoaderWbaBlock=require("./homeBlocksLoaderWbaBlock");let HomeBlocksLoaderWba=function(t){function e(){var e;return(e=t.call(this)||this).blocks=[],e.rowsWhichStatWereSent=new Set,e.itemInViewportEvent=e.itemInViewportEvent.bind(_assertThisInitialized(e)),e.doOnResize=e.$helper.debounce(e.doOnResize.bind(_assertThisInitialized(e)),500),e}_inheritsLoose(e,t);var o=e.prototype;return o.init=function(t){this.bannersReady=t;const e=this._getAllBlocksFromDOM();this.blocks=this._toStatBlocks(e),this._update(),this._bindEvents()},o.destroy=function(){var t;null===(t=this.observer)||void 0===t||t.destroy(),this._unbindEvents()},o.updateBlocks=function(){const t=this._getAllBlocksFromDOM(),e=[];for(let o=0;o<t.length;o++){const n=t[o],s=this.blocks.find(t=>t.block==n);!s||"main"==s.type&&!s.rendered?e.push(new HomeBlocksLoaderWbaBlock(t[o])):e.push(s)}this.blocks=e,this._update()},o.addStories=function(t){console.log("addStories");const e=this.blocks.find(t=>"3"==t.type);this._onBlockItemsRendered(e,t)},o.addRecommendationBlock=function(t){const e=this.blocks.find(e=>{var o;return e.block.id==(null==t||null===(o=t.block)||void 0===o?void 0:o.id)});this._onBlockItemsRendered(e,null==t?void 0:t.block)},o._getAllBlocksFromDOM=function(){return document.querySelectorAll(".j-main-page-block")},o._toStatBlocks=function(t){const e=[];return null==t||t.forEach(t=>e.push(new HomeBlocksLoaderWbaBlock(t))),e},o._onBlockItemsRendered=function(t,e){null==t||t.onBlockItemsRendered(e),this._update()},o._update=function(){this.statRows=this.blocks.reduce((t,e)=>{var o;return null!==(o=e.rows)&&void 0!==o&&o.length?(e.rows.forEach((e,o)=>{t.push(e)}),t):t},[]);const t=this.statRows.map(t=>t.itemForWatch);this.observer=this._getObserver(t),this.observer.observe()},o._getObserver=function(t){const e=this;this.observer&&this.observer.destroy();const o=this.$observerHelper.getVerticalObserver(t,{threshold:.7},{eventDetails:{mainBlocksWBA:!0}});return{observe:function(){t.forEach(t=>{t.addEventListener(o.elementInViewportEventName,e.itemInViewportEvent)}),o.observe()},destroy:function(){o.destroy(),t.forEach(t=>{t.removeEventListener(o.elementInViewportEventName,e.itemInViewportEvent)})}}},o.doOnResize=function(){this.blocks.forEach(t=>t.onResize()),this._update()},o.itemInViewportEvent=function(t){var e;if(null===(e=t.detail)||void 0===e||!e.mainBlocksWBA)return;const o=t.target,n=o.wbDetails||this.statRows.find(t=>t.itemForWatch==o);if(null==n||!n.statInfo)return;const s=n.statInfo,i=this.statRows.indexOf(n)+1;this.rowsWhichStatWereSent.has(i)||s.itemsCountByTails.forEach(t=>{const e={tail:t.analiticsCode,number:i,quantity:t.itemsCount,quantity_total:s.itemsInRow,height:s.height,width:s.width};this.$analitic.sendEvent("Main_LineBlock_S",e),this.rowsWhichStatWereSent.add(i)})},o._bindEvents=function(){window.addEventListener("resize",this.doOnResize)},o._unbindEvents=function(){window.removeEventListener("resize",this.doOnResize)},e}(WbSpaModel);module.exports=HomeBlocksLoaderWba;

},{"./homeBlocksLoaderWbaBlock":3}],3:[function(require,module,exports){
"use strict";let HomeBlocksLoaderWbaBlock=function(){function t(t){this.rows=[],this.rendered=!1,this._toBlock(t)}var e=t.prototype;return e.onBlockItemsRendered=function(t){const e=this._getDataForBlock(this.block,this.type,t);e&&(this.itemsSelector=e.itemsSelector,this.blockInfo=e.blockInfo,this.items=this._getItems(this.block,this.itemsSelector),this.items.length>0&&(this.rendered=!0,this.rows=this._createStatRows()))},e.onResize=function(){this.rendered&&(this.items=this._getItems(this.block,this.itemsSelector),this.items.length>0&&(this.rows=this._createStatRows()))},e._toBlock=function(t){const e=t.dataset.blockType;e&&(this.type=e,this.block=t,"main"!=this.type&&"0"!=this.type||this.onBlockItemsRendered())},e._getDataForBlock=function(t,e,o){switch(e){case"main":return this._getDataForMainBannersBlock(t);case"0":return this._getDataForBannersBlock(t);case"1":return this._getDataForRecommendationsBlock(o);case"3":return this._getDataForStoriesBlock(o);default:return null}},e._getDataForMainBannersBlock=function(t){return{itemsSelector:".j-main-banners",blockInfo:{analiticsCode:t.dataset.analiticsCode}}},e._getDataForBannersBlock=function(t){const{data:e}=$.view(t);return{itemsSelector:".j-banner-wba",blockInfo:{analiticsCode:e.analiticsCode,rows:e.rows}}},e._getDataForRecommendationsBlock=function(t){return{itemsSelector:".j-product-item",blockInfo:{rows:!(null==t?void 0:t.enableShowMoreBtn)&&(null==t?void 0:t.rowsCount)}}},e._getDataForStoriesBlock=function(t){return{itemsSelector:".j-story",blockInfo:{analiticsCode:null==t?void 0:t.analiticsCode,rows:null==t?void 0:t.rowsCount}}},e._getItems=function(t,e){return[...t.querySelectorAll(e)||[]]},e._createStatRows=function(){const t=this.items[0].getBoundingClientRect(),e=t.width,o=t.height,n=this.block.getBoundingClientRect(),i=this._getItemsInRowCount(n.width,e),s=this._getRows(this.items,n,t,i),r=t=>Math.round(100*t)/100,a={itemsInRow:r(i),width:r(e),height:r(o)};return(null==s?void 0:s.map(t=>{a.itemsCountByTails=this._getItemsCountByTailsInRow(t,this.blockInfo,a.itemsInRow);const e={itemForWatch:t[0],statInfo:a};return e.itemForWatch.wbDetails=e,e}))||[]},e._getItemsCountByTailsInRow=function(t,e,o){if(e.analiticsCode)return[{analiticsCode:e.analiticsCode,itemsCount:o}];const n=t.reduce((t,e,n)=>{const i=e.dataset.analiticsCode,s=t.get(i)||0,r=n>o?Math.floor(o%1*100)/100:1;return i?t.set(i,s+r):t},new Map);return[...n.keys()].map(t=>({analiticsCode:t,itemsCount:n.get(t)}))},e._getItemsInRowCount=function(t,e){if(!t||!e)return null;const o=t/e;return"3"===this.type&&"m"===wb.settings.displayMode?o:parseInt(o)},e._getRows=function(t,e,o,n){if(null==e||!e.height||!n)return null;const i=Math.floor(e.height/o.height);return i?(n=Math.ceil(n),Array.from(Array(i).keys()).map(e=>t.slice(e*n,(e+1)*n)).filter(t=>t.length>0)):null},t}();module.exports=HomeBlocksLoaderWbaBlock;

},{}],4:[function(require,module,exports){
"use strict";function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}module.exports=(t=>(function(t){function e(e,i){var n;return(n=t.call(this,e,{cardSelector:".j-product-item",isCarouselCard:!0})||this).getAnaliticsCode=i.getAnaliticsCode,n.targetUrl=i.targetUrl,n.analiticsData={onCardOpen:n.onCardOpen.bind(_assertThisInitialized(n)),onCardClick:n.onCardClick.bind(_assertThisInitialized(n))},n}_inheritsLoose(e,t);var i=e.prototype;return i.onCardClick=function(t){this._updateAnalitics(t)},i.onCardOpen=function(t){this._updateAnalitics(t)},i.setProducts=function(t){this.allProducts=this.allProducts.concat(null!=t?t:[])},i.getCardIndex=function(t,e){const{start:i}=t.closest(".j-goods-wrapper").dataset;return parseInt(i)+e.getIndex()+1},i._updateAnalitics=function(t){const e=t.currentTarget,{data:i}=$.view(e);let{analiticsCode:n,start:r}=e.closest(".j-goods-wrapper").dataset;const o=parseInt(e.dataset.index)+parseInt(r);if(n=i.isAdv?"MAB":n){const t={l:n,iid:(isNaN(o)?0:o)+1};var s,a;if(i.isAdv)t.t="",t.t1=null!==(s=i.advertId)&&void 0!==s?s:-1,t.t2=null!==(a=i.cpm)&&void 0!==a?a:-1,t.t3="";this.$analitic.saveState(t)}},e})(t));

},{}],5:[function(require,module,exports){
"use strict";const HomeVisitedRecommendationsLoader=require("./recommendationsLoader/visitedRecommendationsLoader"),HomeHitsRecommendationsLoader=require("./recommendationsLoader/hitRecommendationsLoader");let RecommedationsLoaderFactory=function(){function e(){}return e.create=function(e){switch(e.name){case"visited":return new HomeVisitedRecommendationsLoader(e);case"hits":default:return new HomeHitsRecommendationsLoader(e)}},e}();module.exports=RecommedationsLoaderFactory;

},{"./recommendationsLoader/hitRecommendationsLoader":6,"./recommendationsLoader/visitedRecommendationsLoader":9}],6:[function(require,module,exports){
"use strict";function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}const HomeRecommendationsLoader=require("./recommendationsLoader"),SERVICE_URL="https://main-page.wildberries.ru/api/v2/site-recommendation";let HomeHitsRecommendationsLoader=function(t){function e(e){var s;return(s=t.call(this,e)||this).adverts=[],s.advGoods=[],s.includeSoldOut=!1,s.checkedAdvCount=0,s.user=null,s}_inheritsLoose(e,t);var s=e.prototype;return s.provideGoodsAsync=function(t,e,s=0,o=0){return this.nmIdsLoaded&&0==this.nms.length?{goods:[],adv:[]}:this.goods.length>=t+e&&this.advGoods.length>=s+o?{goods:this.goods.slice(t,t+e),adv:this.advGoods.slice(s,s+o)}:this.goods.length>=t+e&&this.nmIdsLoaded&&this.checkedAdvCount>=this.adverts?{goods:this.goods.slice(t,t+e),adv:[]}:this.nmIdsLoaded&&this.checkedNmCount>=this.nms.length?{goods:this.goods.slice(t,t+e),adv:[]}:this._loadGoods(t,e,s,o)},s._loadGoods=async function(t,e,s,o){let i;if(this.nmIdsLoaded||await this._loadNmIds(),this.goodsChunksCache.has(this.currentChunk))i=this.goodsChunksCache.get(this.currentChunk);else{const t=this.goods.length,e=this.advGoods.length,s=this.nms.length-this.checkedNmCount,n=this.adverts.length-this.checkedAdvCount,d=Math.min(Math.ceil((t+this.chunkSize-7*e)/8),n)*(o>0),r=Math.min(s,this.chunkSize-d),h=this.nms.slice(this.checkedNmCount,this.checkedNmCount+r),a=this.adverts.slice(this.checkedAdvCount,this.checkedAdvCount+d),c=a.map(t=>t.id),l=a.toMap(t=>t.id,t=>t);this.checkedNmCount+=r,this.checkedAdvCount+=d,i=wb.xnm.getGoodsForRecommendAndCatalog([...h,...c],this.includeSoldOut,!0).then(t=>(t.forEach(t=>{if(l.has(t.cod1S)){var e;const s=l.get(t.cod1S);t.isAdv=!0,t.advertId=s.advertId,t.cpm=s.cpm,t.subjectId=null!==(e=t.subjectId)&&void 0!==e?e:s.subject,t.brandId=s.brand,this.advGoods.push(t)}else this.goods.push(t)}),Promise.resolve(t))),this.goodsChunksCache.set(this.currentChunk,i)}return await i,this.currentChunk++,this.provideGoodsAsync(t,e,s,o)},s._loadNmIds=async function(){var t,e,s,o,i;if(this.loadNmIdsTask)return this.loadNmIdsTask;const n=new this.$helper.Deferred;this.loadNmIdsTask=n.promise;const d=this.$services.cartService.getItems().map(t=>t.cod1S);null==this.user&&(this.user=await("any"in Promise?Promise.any([this.$user.getUserInfo(),new Promise(t=>setTimeout(t,2e3))]):this.$user.getUserInfo()));const r=await this.$analitic.getSplitterHeaders(),h=this.$recentViews.get(),a={count:1e3,referrer:null!==(t=null===(e=this.$router)||void 0===e?void 0:e.referrer)&&void 0!==t?t:"",locale:WbSpaModel.prototype.$user.getLocale()};(null===(s=h.nm)||void 0===s?void 0:s.length)>0&&(a.nms=h.nm.slice(0,10)),(null===(o=h.url)||void 0===o?void 0:o.length)>0&&(a.urls=h.urls),(null===(i=h.query)||void 0===i?void 0:i.length)>0&&(a.queries=h.query),d.length>0&&(a.basket_nms=d);try{var c;const t=await this.$httpClient.fetchBasicJSON(SERVICE_URL,{method:"POST",body:JSON.stringify(a),credentials:"omit",headers:r},{timeout:1e4});var l;if((null==t||null===(c=t.nms)||void 0===c?void 0:c.length)>0)this.isPersonal=1===t.flag,this.nms=t.nms,this.adverts=null!==(l=t.adverts)&&void 0!==l?l:[]}catch(t){console.error(t)}finally{this.nmIdsLoaded=!0,n.resolve()}},e}(HomeRecommendationsLoader);module.exports=HomeHitsRecommendationsLoader;

},{"./recommendationsLoader":8}],7:[function(require,module,exports){
"use strict";function _inheritsLoose(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,_setPrototypeOf(t,o)}function _setPrototypeOf(t,o){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t})(t,o)}let RecommendationsBlock=function(t){function o(o){var s;return(s=t.call(this)||this).id=o.id,s.goods=[],s.ordiaryGoods=[],s.advGoods=[],s.startIndex=o.startCardIndex,s.rowLength=o.rowLength,s.rowsCount=o.rowsCount,s.goodsCount=o.rowLength*o.rowsCount,s.advIndex=o.advIndex,s.advCount=o.advertCount,s.advPositions=o.advertPositions,s.advBoundaries=o.advertBoundaries,s.showTitle=o.showTitle,s.name=o.blockName,s.targetUrl=o.targetUrl,s.enableShowMoreBtn=o.enableShowMoreBtn,s.isPersonal=!1,s.getHomeCardsManager=o.getHomeCardsManager,s}_inheritsLoose(o,t);var s=o.prototype;return s.setGoods=function(t){this.ordiaryGoods=t},s.addRowCount=function(t){this.rowsCount+=t,this.goodsCount=this.rowLength*this.rowsCount},s.setAdvertGoods=function(t){this.advGoods=null!=t?t:[]},s.setShowMoreBtn=function(t){$.observable(this).setProperty({showBtn:this.enableShowMoreBtn&&t})},s.setIsPersonal=function(t){this.isPersonal=t},s.addGoods=function(t){$.observable(this.goods).insert(null!=t?t:[]),this.homeCardsManager.setProducts(this.goods)},s.render=async function(t){this.goods=this.ordiaryGoods.slice(0,this.goodsCount),this.advCount>0&&this.advGoods.length>0&&this.mergeAdvGoods(),this.homeCardsManager||(this.homeCardsManager=await this.getHomeCardsManager()),this.homeCardsManager.setProducts(this.goods),this.cardsManagerDataLinkActions=this.homeCardsManager.getDataLinkActions("homeCardsManager"),$.link.newrecommendedgoods(t,this)},s.mergeAdvGoods=function(){for(let s=0;s<this.advGoods.length;s++){var t;const e=this.advGoods[s];let n=null===(t=this.advPositions)||void 0===t?void 0:t[s];if(null==n){var o;const[t,s]=null!==(o=this.advBoundaries)&&void 0!==o?o:[1,this.rowLength];n=t+Math.floor(Math.random()*(s+1-t))}n=this.rowLength*s+(n-1),e.advPostion=n+1,this.goods[n]=e}},s.sendAdvertShowEvent=function(){this.goods.filter(t=>t.isAdv).forEach(t=>{const o=this._getAdvStatParam(t);this.$stat.sendEvent("AREMS",o)})},s.sendAdvertClickEvent=function(t){const{data:o}=$.view(t.currentTarget);o&&this.$stat.sendEvent("AREMC",this._getAdvStatParam(o),!0)},s.renderDynamicGoods=function(){this.setShowMoreBtn(!1);const t={id:this.id,startIndex:this.startIndex,goodsCount:this.goods.length};this.$eventBus.dispatchEvent(new CustomEvent("RecommendationBlockRequireGoods",{detail:t}))},s.beforeRouterTransition=function(t){const{data:o}=$.view(t.currentTarget);null==o||o.isService||this.$services.productCard.stashCatalogProduct(o)},s._getAdvStatParam=function(t){return[this.$stat.wrapParam("PARAM1",0),this.$stat.wrapParam("PARAM2",t.advertId),this.$stat.wrapParam("PARAM3",t.cod1S),this.$stat.wrapParam("PARAM4",t.advPostion),this.$stat.wrapParam("PARAM5",t.cpm),this.$stat.wrapParam("PARAM6",t.subjectId)]},o}(WbSpaModel);module.exports=RecommendationsBlock;

},{}],8:[function(require,module,exports){
"use strict";function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}const RecommendationsBlock=require("./recommendationsBlock"),HomeCardsManager=require("../homeRecommendationsCard");let HomeRecommendationsLoader=function(e){function t(t){var o;return(o=e.call(this)||this).dataUrl=t.dataUrl,o.name=t.name,o.sizeForDynamicGoods=t.sizeForDynamicGoods,o.sizeForStaticGood=t.sizeForStaticGood,o.targetUrl=t.targetUrl,o.title=t.title,o.analiticsCode=t.analiticsCode,o.isPersonal=!1,o.nmIdsLoaded=!1,o.nms=[],o.goods=[],o.chunkSize=100,o.currentChunk=1,o.goodsChunksCache=new Map,o.checkedNmCount=0,o.blocks=new Map,o.onGoodsRequired=o.onGoodsRequired.bind(_assertThisInitialized(o)),o.getHomeCardsManager=o.getHomeCardsManager.bind(_assertThisInitialized(o)),o.initHomeCardsManagerTask=o._initHomeCardsManager(),o.observerProducts=o.$observerHelper.getVerticalObserver([],{keepObserve:!1,sendOutEvent:!1},{threshold:.8}),o}_inheritsLoose(t,e);var o=t.prototype;return o.init=function(){this._bindEvents()},o.destroy=function(){var e,t;this._unbindEvents(),null===(e=this.homeCardsManager)||void 0===e||e.destroy(),null===(t=this.observerProducts)||void 0===t||t.destroy()},o.onGoodsRequired=async function(e){var t;const{id:o,startIndex:n,goodsCount:s}=null!==(t=e.detail)&&void 0!==t?t:{};if(!this.blocks.has(o))return;const i=this.blocks.get(o),{goods:a=[]}=await this.provideGoodsAsync(n+s,this.sizeForDynamicGoods+1),r=a.slice(0,this.sizeForDynamicGoods);i.addGoods(r),i.setShowMoreBtn(a.length>this.sizeForDynamicGoods),document.dispatchEvent(new CustomEvent("DynamicCarouselRendered",{detail:{block:i}})),this._sendViewItemListStateWba(r),this.observerProducts.update(document.getElementById(i.id).querySelectorAll(".j-product-item"))},o.addBlock=function(e){const t={targetUrl:this.targetUrl,sizeForDynamicGoods:this.sizeForDynamicGoods,getHomeCardsManager:this.getHomeCardsManager,...e};this.blocks.set(e.id,new RecommendationsBlock(t))},o.renderCarousel=async function(e){var t,o;const n=this.blocks.get(e),s=document.getElementById(e);if(null==n||null==s||n.goods.length>0)return;const[i]=await Promise.all([this.provideGoodsAsync(n.startIndex,n.goodsCount,n.advIndex,n.advCount),$.views.loadTemplateAsync("newrecommendedgoods")]),{goods:a=[],adv:r=[]}=null!=i?i:{};(null==a?void 0:a.length)<1&&s.classList.add("hide"),n.setGoods(a),n.setAdvertGoods(r),n.setIsPersonal(this.isPersonal),n.setShowMoreBtn(this.goods.length+(null!==(t=null===(o=this.advGoods)||void 0===o?void 0:o.length)&&void 0!==t?t:0)>this.sizeForStaticGood),await n.render(s),n.sendAdvertShowEvent(),document.dispatchEvent(new CustomEvent("DynamicCarouselRendered",{detail:{block:n}})),this._sendViewItemListStateWba(n.goods),this.observerProducts.update(s.querySelectorAll(".j-product-item"))},o.getHomeCardsManager=async function(){return this.homeCardsManager||await this.initHomeCardsManagerTask,this.homeCardsManager},o._initHomeCardsManager=async function(){const e=(await this.$moduleLoader.loadModuleAsync("catalogCore")).getCatalogCardBaseActionsBinderClass(),t=HomeCardsManager(e);this.homeCardsManager=new t(null,{targetUrl:this.targetUrl,getAnaliticsCode:this._getAnaliticsCode.bind(this)}),this.homeCardsManager.init()},o._getAnaliticsCode=function(e){return null!=e&&e.isAdv?"MAB":this.analiticsCode},o._sendViewItemListStateWba=function(e){const t=e.map((e,t)=>{var o;const n=[this._getAnaliticsCode(e),"","PP","",e.isAdv?e.advertId:"",e.isAdv?e.cpm:"",""];return{id:null===(o=e.nmId)||void 0===o?void 0:o.toString(),name:e.name,brand:e.brand,price:e.priceWithCouponAndDiscount,inListIndex:t+1,listName:n.join("|"),subjectId:e.subjectId,subjectParentId:e.subjectParentId,feedbacksCount:e.feedbacks,rating:e.reviewRating}}),o={page:1,link:window.location.origin,goods:e.length};this.$analitic.sendWbaEcomStat("view_item_list",t,o)},o._bindEvents=function(){this.$eventBus.addEventListener("RecommendationBlockRequireGoods",this.onGoodsRequired)},o._unbindEvents=function(){this.$eventBus.removeEventListener("RecommendationBlockRequireGoods",this.onGoodsRequired)},t}(WbSpaModel);module.exports=HomeRecommendationsLoader;

},{"../homeRecommendationsCard":4,"./recommendationsBlock":7}],9:[function(require,module,exports){
"use strict";function _inheritsLoose(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t,_setPrototypeOf(t,s)}function _setPrototypeOf(t,s){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t})(t,s)}const HomeRecommendationsLoader=require("./recommendationsLoader");let HomeVisitedRecommendationsLoader=function(t){function s(s){var o;return(o=t.call(this,s)||this).visitedLocally=!1,o.includeSoldOut=!0,o}_inheritsLoose(s,t);var o=s.prototype;return o.provideGoodsAsync=function(t,s){return this.nmIdsLoaded&&0==this.nms.length?{goods:[]}:this.goods.length>=t+s?{goods:this.goods.slice(t,t+s)}:this.nmIdsLoaded&&this.checkedNmCount>=this.nms.length?{goods:this.goods.slice(t,t+s),adv:[]}:this._loadGoods(t,s)},o._loadGoods=async function(t,s){let o;if(this.nmIdsLoaded||await this._loadNmIds(t,s),!this.nmIdsLoaded&&this.visitedLocally&&this.nms.length<t+s&&await this._loadNmIds(t,s),this.goodsChunksCache.has(this.currentChunk))o=this.goodsChunksCache.get(this.currentChunk);else{const t=this.nms.slice(this.checkedNmCount,this.checkedNmCount+this.chunkSize);this.checkedNmCount+=t.length,o=wb.xnm.getGoodsForRecommendAndCatalog(t,this.includeSoldOut,!0),this.goodsChunksCache.set(this.currentChunk,o)}const e=await o;return this.goods.push(...null!=e?e:[]),this.currentChunk++,this.provideGoodsAsync(t,s)},o._loadNmIds=async function(){if(!this.visitedLocally)return this._loadLocalNms();if(this.loadNmIdsTask)return this.loadNmIdsTask;const t=new this.$helper.Deferred;this.loadNmIdsTask=t.promise;try{var s;const o=await this.$httpClient.fetchBasicJSON(this.dataUrl,{method:"POST",body:null},{timeout:2e3});let e=(null==o||null===(s=o.value)||void 0===s||null===(s=s.nmsArr)||void 0===s?void 0:s.length)>0?o.value.nmsArr:[];const i=this.nms.toHashSet();e=e.filter(t=>!i.has(t)),this.nms.push(...e)}catch(t){console.error(t)}finally{this.nmIdsLoaded=!0,t.resolve()}},o._loadLocalNms=function(){var t;this.visitedLocally=!0;const s=this.$recentViews.get(),o=(null===(t=s.nm)||void 0===t?void 0:t.length)>0?s.nm:[];this.nms.push(...o)},s}(HomeRecommendationsLoader);module.exports=HomeVisitedRecommendationsLoader;

},{"./recommendationsLoader":8}]},{},[1]);
