(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";!function(){const e=require("./catalog_v2/brand/brandGoodsCatalog"),t=require("./catalog_v2/brand/brandConstructorCatalog");let o=function(){function o(e){var t;const o=null!==(t=null==e?void 0:e.data)&&void 0!==t?t:e;this.type=o.type,this.model=o.model,this.brandId=o.model.brandInfo.id,this.category=this.$router.routeParameters.category}var n=o.prototype;return n.onBeforeRender=async function(e,t){var o;const n=null!==(o=null==e?void 0:e.data)&&void 0!==o?o:e,r=this.getReqiredModel();$.observable(this).setProperty({currentModel:r}),await this.currentModel.onBeforeRender(n.model,t);const{brandInfo:i}=n.model;this._sendBrandAnalytic(i.name,i.id)},n.onAfterRender=function(e){var t,o,n;const r=null!==(t=null==e?void 0:e.data)&&void 0!==t?t:e;null===(o=(n=this.currentModel).onAfterRender)||void 0===o||o.call(n,r.model)},n.onBeforeUnrender=function(){var e,t;null===(e=(t=this.currentModel).onBeforeUnrender)||void 0===e||e.call(t)},n.onActiveViewChanged=function(e){var t,o;null===(t=(o=this.currentModel).onActiveViewChanged)||void 0===t||t.call(o,e)},n.onHistoryChange=function(e,t,o){const{catalogState:n}=e;if((null==n?void 0:n.brandId)!=this.brandId||(null==n?void 0:n.catalogType)!=this.type||this.category!=(null==n?void 0:n.category))return this._updateModel(t);this.currentModel.onHistoryChange(e,t,o)},n.getReqiredModel=function(){switch(this.type){case 4:case 6:return new e(this);case 5:return new t(this)}},n._updateModel=async function(e){let t;try{t=await this.$router.loadRouteDataAsync(this.$router.currentRoute.requiredData,0,!1,e)}catch(e){if(e.isNotFound)return this.$router.moveTo404Async();if(!e.isCancelled&&!e.isUnauthorize&&null!=e.message&&""!=e.message)return console.log(e.message),this.$router.moveTo500Async(e,{method:"catalog._updateModel",current:window.location.toString(),requiredData:this.$router.currentRoute.requiredData})}try{var o,n,r,i,a,l,d;const{viewData:e}=t,{data:s}=e;this.$setGoogleTagsModel(null!==(o=s.model.googleTagParams)&&void 0!==o?o:this._fillGoogleTagsModel(s.model.brandInfo)),this.$setActionPayRetargetingModel(null!==(n=s.model.actionPayRetargetingData)&&void 0!==n?n:this._fillActionPayRetargetingModel(s.model.brandInfo));const c=this.type;if(this.type=s.type,this.model=s.model,this.brandId=this.model.brandInfo.id,this.category=this.$router.routeParameters.category,c==this.type)return void this.currentModel.update(s);const u=this.getReqiredModel();null===(r=(i=this.currentModel).onBeforeUnrender)||void 0===r||r.call(i);const h=new this.$helper.Deferred;await(null===(a=u.onBeforeRender)||void 0===a?void 0:a.call(u,s.model,h.promise)),$.observable(this).setProperty({currentModel:u}),await this.$helper.nextTick(),h.resolve(),null===(l=(d=this.currentModel).onAfterRender)||void 0===l||l.call(d,s.model);const{brandInfo:g}=s.model;this._sendBrandAnalytic(g.name,g.id)}catch(e){console.error(e),wb.popup.renderModalError(e)}},n._fillGoogleTagsModel=function(e){return{PageType:"brand",Delivery:"Бесплатная доставка",Pcat:null==e?void 0:e.Wname}},n._fillActionPayRetargetingModel=function(e){return{pageType:3,currentCategory:{id:null==e?void 0:e.id,name:null==e?void 0:e.name}}},n._sendBrandAnalytic=function(e,t){this.$analitic.sendEvent("BrandPage_V",{name:e,id:t.toString(),link:window.location.href})},o}();wb.spa.registerViewModel(o)}();

},{"./catalog_v2/brand/brandConstructorCatalog":2,"./catalog_v2/brand/brandGoodsCatalog":3}],2:[function(require,module,exports){
"use strict";function _defineProperties(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}let modulesTask;const CONTAINER_SPECIAL_CLASS="main__container--constructor";let BrandConstructorCatalog=function(t){function e({type:e,brandId:o,category:n}){var r;return(r=t.call(this)||this).type=e,r.brandId=o,r.category=n,r}_inheritsLoose(e,t);var o=e.prototype;return o.onBeforeRender=async function(t){document.getElementById("mainContainer").classList.add(CONTAINER_SPECIAL_CLASS),window._debug&&console.time("loadModules");const[e,o,n]=await this._loadModules();this.sections=e.adaptSections(t,{ConstructorBlocks:e,BrandLikes:n,SitePath:o})},o.onAfterRender=function(){this.$stat.banners.sendStatisticNow(),this.$stat.banners.initClickEvent(!0)},o.onBeforeUnrender=function(){this.$stat.banners.destroyClickEvent(),document.getElementById("mainContainer").classList.remove(CONTAINER_SPECIAL_CLASS)},o.onActiveViewChanged=function(t){document.getElementById("mainContainer").classList.toggle(CONTAINER_SPECIAL_CLASS,t)},o.update=async function({model:t}){document.getElementById("mainContainer").classList.add(CONTAINER_SPECIAL_CLASS);const[e,o,n]=await this._loadModules(),r=e.adaptSections(t,{ConstructorBlocks:e,BrandLikes:n,SitePath:o});window.requestAnimationFrame(()=>{$.observable(this.sections).refresh(r)})},o._loadModules=function(){return null==modulesTask&&(modulesTask=Promise.all([this.$moduleLoader.loadModuleAsync("brandConstructorBlocks"),this.$moduleLoader.loadModuleAsync("catalogSitePath"),this.$moduleLoader.loadModuleAsync("catalogBrandLikes")])),modulesTask},_createClass(e,[{key:"template",get:function(){return $.views.templates.brandConstructorCatalog}}]),e}(WbSpaModel);module.exports=BrandConstructorCatalog;

},{}],3:[function(require,module,exports){
"use strict";function _defineProperties(t,e){for(var o=0;o<e.length;o++){var a=e[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,_toPropertyKey(a.key),a)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,e||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}let XCatalogData,BrandGoodsCatalog=function(t){function e({type:e,model:o,brandId:a,category:r}){var i;return(i=t.call(this)||this).catalogType=e,i.brandInfo=o.brandInfo,i.brandId=a,i.title=o.title,i.category=r,i.metaTags=o.metaTags,i.emptyCatalog=!1,i.showBrandLogo=i.showBrandLogo.bind(_assertThisInitialized(i)),i.onEmptyGoodsList=i.onEmptyGoodsList.bind(_assertThisInitialized(i)),i}_inheritsLoose(e,t);var o=e.prototype;return o.onBeforeRender=async function(t,e){window._debug&&console.time("loadModules"),null==t.products&&(t.products=[]);const[o,a,r,i,s,{XCatalogData:n},{CatalogSorterModel:d}]=await Promise.all([this.$moduleLoader.loadModuleAsync("catalogCore"),this.$moduleLoader.loadModuleAsync("xCatalogProvider"),this.$moduleLoader.loadModuleAsync("catalogSitePath"),this.$moduleLoader.loadModuleAsync("catalogBrandLikes"),this.$moduleLoader.loadModuleAsync("queryHelper"),this.$moduleLoader.loadModuleAsync("xCatalogData"),this.$moduleLoader.loadModuleAsync("sorterModel")]);window._debug&&console.timeEnd("loadModules"),XCatalogData=n;const l=Number.tryParseInt(window.location.hash.slice(2)),c=s.getInitialParams(),{page:u=1,sort:h=d.getSortFromCookie,cardsize:g,...y}=c,p=this._createXData(t),m=new s({sort:h,page:u,filters:y,cardsize:g},this.baseCatalogState),M=s.checkOnlyFilterParams(y);t.sorterModel.sortingBase||(t.sorterModel=new d(t.sorterModel.value,t.sorterModel.baseUrl));const f=a.createGoodsProvider(p),b=a.createFiltresProvider(p),v=new o.FiltresSettings(!1),C=o.createAnalytics(p,m,this.catalogType,u,h).init(),w=o.createStatistic(this.catalogType,p,m,d,u,h,g,t.menuId).init(),S=o.createSorter(t.sorterModel,m).init(),P=o.createSizePicker(g,window.location.href,m),L=o.createPager(null!=u?u:1,m).init(),_=o.createGoodsLoader(m).setProvider(f).init(),I=o.cteateCatalogFiltres(m,p,v).setProvider(b).init(M),T=o.createSearchTags(this.catalogType,t.tagsUrl).init(),$=new i(t.brandInfo).init(),E=o.createCatalogPanel().init(),B=E.creatYourChoiceModel(M,m).init();E.addDesktopPanel().addMenuModel(t.rootMenuItem,t.currentMenuItem).addSorterModel(S).addFiltresModel(b).addCardSizeModel(P).addYourChoiceModel(B),E.addMobilePanel().addMenuModel(t.rootMenuItem,t.currentMenuItem).addSorterModel(S).addFiltresModel(b).addCardSizeModel(P).addYourChoiceModel(B),this.queryHelper=m,this.goodsList=o.createGoodsList(t.products,l,this.queryHelper,!0).setEmptyCatalogTemplate("brandsEmptyCatalog").init(e),this.sizerModel=P,this.pagerModel=L,this.filtresModel=I,this.sitePathModel=new r(t.sitePathItems).init(),this.catalogLoader=_,this.panelModel=E,this.sorterModel=S,this.searchTagsModel=T,this.brandLikesModel=$,this.analyticsModel=C,this.statisticModel=w,this.emptyCatalog=0==t.products.length&&0==this.queryHelper.getFiltersQuery().toString().length},o.onAfterRender=function(t){this._bindEvents(),this.$router.replaceState({catalogState:this.catalogState},document.title,window.location.href),this.analyticsModel.sendScreenEvent(),this.quickNavDestroyer=wb.quickNav({bottomPx:document.documentElement.clientHeight}),this._loadMetaTags()},o.onBeforeUnrender=function(){var t,e,o,a,r,i,s,n,d,l,c;this._unbindEvents(),null===(t=this.goodsList)||void 0===t||t.destroy(),null===(e=this.pagerModel)||void 0===e||e.destroy(),null===(o=this.filtresModel)||void 0===o||o.destroy(),null===(a=this.catalogLoader)||void 0===a||a.destroy(),null===(r=this.panelModel)||void 0===r||r.destroy(),null===(i=this.sorterModel)||void 0===i||i.destroy(),null===(s=this.searchTagsModel)||void 0===s||s.destroy(),null===(n=this.sitePathModel)||void 0===n||n.destroy(),null===(d=this.analyticsModel)||void 0===d||d.destroy(),null===(l=this.statisticModel)||void 0===l||l.destroy(),null===(c=this.quickNavDestroyer)||void 0===c||c.call(this)},o.onHistoryChange=function(t,e){const o=this.queryHelper.checkChanges(t.catalogState);if(o.needChangeCardSize){const e=this.sizerModel.getCardSizeByName(t.catalogState.cardSize);this.sizerModel.update(e)}if(o.needUpdateSort){const e=this.sorterModel.getSortByName(t.catalogState.sort);this.sorterModel.update(e)}o.needUpdatePage&&this.pagerModel.update(t.catalogState.page||1),o.needUpdateFilters&&this.filtresModel.update(t.catalogState.filters),(o.needUpdateCatalog||e)&&this.$eventBus.dispatchEvent(new CustomEvent("CatalogQueryUpdated",{detail:{}}))},o.onEmptyGoodsList=function(t){window.requestAnimationFrame(()=>{$.observable(this).setProperty({emptyCatalog:0==this.queryHelper.getFiltersQuery().toString().length})})},o.update=async function({model:t}){var e;if(!t.sorterModel.sortingBase){const{CatalogSorterModel:e}=await this.$moduleLoader.loadModuleAsync("sorterModel");t.sorterModel=new e(t.sorterModel.value,t.sorterModel.baseUrl)}if(!t.xData.dataUrlFilters){const{XCatalogData:e}=await this.$moduleLoader.loadModuleAsync("xCatalogData");t.xData=new e(t.xData.xcatalogQuery,t.xData.xcatalogShard,"Brand")}this.brandId=t.brandInfo.id,this.category=this.$router.routeParameters.category,this.metaTags=t.metaTags;const o=this.queryHelper.getInitialParams(),{page:a,sort:r=this.sorterModel.getSortFromCookie,cardsize:i,...s}=o;this.queryHelper.updateModel({page:a,sort:r,cardsize:i,filters:s},this.baseCatalogState),window.requestAnimationFrame(()=>{$.observable(this).setProperty({brandInfo:t.brandInfo,title:t.title,emptyCatalog:0==t.products.length&&0==this.queryHelper.getFiltersQuery().toString().length})}),this.$router.replaceState({catalogState:this.catalogState},document.title,window.location.href),t.selectedHasChild=!1,this.$eventBus.dispatchEvent(new CustomEvent("CatalogUpdated",{detail:t})),null===(e=this.brandLikesModel)||void 0===e||e.update(t.brandInfo),this._loadMetaTags()},o.showBrandLogo=function(){window.requestAnimationFrame(()=>{$.observable(this.brandInfo).setProperty({logoLoaded:!0})})},o._getCatalogTypeInfoWba=function(){return this.$router.queryParams.has("bid")?{type:"Banner",val:this.$router.queryParams.get("bid")}:{type:"Brand",val:this.brandId}},o._createXData=function(t){return new XCatalogData(t.xData.xcatalogQuery,t.xData.xcatalogShard,"Brand",this._getCatalogTypeInfoWba())},o._loadMetaTags=async function(){let t=this.metaTags;if(t?this.$seoHelper.render(t):t=await this.$seoHelper.update(window.location.pathname,this.$router.currentRoute.metaTagsUrl),!t)return;const e=t.find(t=>"H1"===t.tagName);e&&window.requestAnimationFrame(()=>$.observable(this).setProperty({title:e.hTMLContent}))},o._bindEvents=function(){this.$eventBus.addEventListener("CatalogEmptyGoodsList",this.onEmptyGoodsList)},o._unbindEvents=function(){this.$eventBus.removeEventListener("CatalogEmptyGoodsList",this.onEmptyGoodsList)},_createClass(e,[{key:"template",get:function(){return $.views.templates.brandGoodsCatalog}},{key:"baseCatalogState",get:function(){return{catalogType:this.catalogType,brandId:this.brandId,category:this.category}}},{key:"catalogState",get:function(){return{...this.baseCatalogState,...this.queryHelper.toState()}}}]),e}(WbSpaModel);module.exports=BrandGoodsCatalog;

},{}]},{},[1]);
