(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";!function(){let e=function(){function e(e){this.$storageHelper=e,this.storageHelper=this.$storageHelper.createStorageHelperItem("constructorBrands",e=>{e.objectStoreNames.contains("brands")&&e.deleteObjectStore("brands"),e.createObjectStore("brands",{keyPath:"id"}),e.objectStoreNames.contains("brandIds")&&e.deleteObjectStore("brandIds"),e.createObjectStore("brandIds",{keyPath:"id"})},1)}var t=e.prototype;return t.getConstructorBrands=async function(e,t){const r=e?1:0;return this.storageHelper.updateCacheAsync("brandIds",r,this.$storageHelper.cacheActivityType.normal,async()=>{try{const e=await t();return{id:r,value:e}}catch(e){return console.error(e),null}}).then(e=>Promise.resolve(null==e?void 0:e.value))},t.getBrandSchemeAsync=async function(e,t,r,n,a){const s=`${e.id}-${t}-${n?1:0}-${null!=r?r:""}`;return this.storageHelper.updateCacheAsync("brands",s,this.$storageHelper.cacheActivityType.normal,async()=>{try{const e=await a();return{id:s,value:e}}catch(e){return console.error(e),null}}).then(e=>Promise.resolve(null==e?void 0:e.value))},e}();module.exports=e}();

},{}],2:[function(require,module,exports){
"use strict";function _defineProperties(e,i){for(var t=0;t<i.length;t++){var r=i[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,i,t){return i&&_defineProperties(e.prototype,i),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var i=_toPrimitive(e,"string");return"symbol"==typeof i?i:String(i)}function _toPrimitive(e,i){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,i||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}!function(){const e=Object.freeze({main:1,catalog:2,infoPage:3}),i=Object.freeze({header:1,mainBanner:2,menu:3,menuInfo:4,mixed:5,preview:6,catalog:7,filters:8,infoBlock:9}),t=Object.freeze({simpleWithLink:1,simpleNoLink:2,recent:20}),r=Object.freeze({simpleDouble:1,simpleSingle:2,image:3}),l=Object.freeze({h1:r.simpleDouble,h2:r.simpleDouble,h3:r.simpleDouble,h4:r.simpleDouble,h5:r.simpleDouble,h6:r.simpleDouble,p:r.simpleDouble,span:r.simpleDouble,small:r.simpleDouble,strong:r.simpleDouble,b:r.simpleDouble,em:r.simpleDouble,i:r.simpleDouble,sub:r.simpleDouble,sup:r.simpleDouble,ins:r.simpleDouble,del:r.simpleDouble,mark:r.simpleDouble,ul:r.simpleDouble,ol:r.simpleDouble,li:r.simpleDouble,br:r.simpleSingle,img:r.image});let n=function(){function n(){}return n.getUrlPartByPageType=function(e){switch(e){case this.pageType.main:return"brandzone";case this.pageType.infoPage:return"infopage";default:return"catalogpage"}},_createClass(n,null,[{key:"pageType",get:function(){return e}},{key:"brandSchemeBlockType",get:function(){return i}},{key:"previewTemplateType",get:function(){return t}},{key:"infoBlockHtmlTagType",get:function(){return r}},{key:"tagTypes",get:function(){return l}}]),n}();module.exports=n}();

},{}],3:[function(require,module,exports){
"use strict";!function(){const e=require("./brandConstructorEnums"),n=require("./brandSchemeConverter"),t=require("./brandConstructorCache");let r=function(){function r(){this.url="https://brandzones.wildberries.ru/api/v1/",this.enums=e,this.converter=new n(this.enums),this.storageHelper=new t(this.$storageHelper)}var i=r.prototype;return i.getConstructorBrands=async function(e){return this.storageHelper.getConstructorBrands(e,()=>this._getConstructorBrandsApi(e))},i.getPageInfo=function(e){if(!e)return null;const n=e.split("/"),t="preview"==n[2]?1:0;let r=this.enums.pageType.catalog,i=null;return n.length==4+t?r=this.enums.pageType.main:"info"==n[4+t]&&n[5]&&(r=this.enums.pageType.infoPage,i=n[5]),{pageType:r,infoUrl:i,previewMode:!!t}},i.getBrandSchemeAsync=async function(e,n,t,r){return this.storageHelper.getBrandSchemeAsync(e,n,t,r,async()=>{try{const i=await this._getBrandSchemeAsyncApi(e,n,t,r);return i?this.converter.toScheme(i,n):null}catch(e){return console.error(e),null}})},i.getMenus=async function(e,n,t,r){var i,s;const o=await this.getBrandSchemeAsync(e,n,t,r);return o?{menu:null===(i=o.blocks)||void 0===i||null===(i=i.find(e=>e.type==this.enums.brandSchemeBlockType.menu))||void 0===i?void 0:i.data,infoMenu:null===(s=o.blocks)||void 0===s||null===(s=s.find(e=>e.type==this.enums.brandSchemeBlockType.menuInfo))||void 0===s?void 0:s.data}:null},i.getMainBanners=async function(e){var n;const t=await this.getBrandSchemeAsync(e.brandData,this.enums.pageType.main,"",e.previewMode);return t?null==t||null===(n=t.blocks)||void 0===n||null===(n=n.find(e=>e.type==this.enums.brandSchemeBlockType.mainBanner))||void 0===n?void 0:n.data:null},i.convertSchemeToViewModel=function(e,n,t){return this.converter.toSchemeViewModel(e,n,t)},i._getConstructorBrandsApi=async function(e){const n=e?"moderation-brands":"activebrands";try{const e=`${this.url}site/${n}-content`;return await this.$httpClient.fetchBasicJSON(e,{credentials:"omit"},{timeout:3e3,nullOnError:!0})}catch(e){return null}},i._getBrandSchemeAsyncApi=async function(e,n,t,r){const i=new URLSearchParams({siteID:e.siteId,admin:!!r,contentID:e.id}),s=this.enums.getUrlPartByPageType(n);(null==t?void 0:t.length)>0&&i.append("href",t);const o=`${this.url}site/${s}?${i}`;return await this.$httpClient.fetchBasicJSON(o,{credentials:"omit"},{timeout:3e3,nullOnError:!0})},r}();window.__spaServiceManager__.register("brandConstructorService",r)}();

},{"./brandConstructorCache":1,"./brandConstructorEnums":2,"./brandSchemeConverter":4}],4:[function(require,module,exports){
"use strict";!function(){let e=function(){function e(e){this.enums=e}var t=e.prototype;return t.toScheme=function(e,t){var n;const r=[],i=new Map;return null==e||null===(n=e.sections)||void 0===n||n.filter(e=>!!e).forEach((e,t)=>{var n;const o=[];null===(n=e.blocks)||void 0===n||n.filter(e=>!!e).forEach((e,n)=>{const r=100*t+n,l=this._toBlock(e,r);o.push(l.blockId),i.set(r,l)}),o.length>0&&r.push({inContainer:!!e.incontainer,columnCount:e.columncount,blockIds:o})}),{pageType:t,sections:r,blocks:i}},t.toSchemeViewModel=function(e,t,n){var r;const i=null===(r=e.sections)||void 0===r?void 0:r.map(n=>{const r=n.blockIds.reduce((n,r)=>{const i=e.blocks.get(r),o=i.columnNumber;return n[o]=[...n[o]||[],this._toBlockViewModel(i,t)],n},{});return n.blocks=r,n});return{hasCustomMenu:t.hasCustomMenu,pageType:e.pageType,previewMode:t.previewMode,brandMainPageLink:t.fullMenu[0].url,currentInfoPage:n.isInfo?n.url:"",sections:i}},t._toBlockViewModel=function(e,t){if(e.type==this.enums.brandSchemeBlockType.preview&&e.data.needFillXData){var n;const r=null===(n=e.data.brandPreviews)||void 0===n?void 0:n.map(e=>{var n;const r=null==e||null===(n=e.url)||void 0===n?void 0:n.split("?");if(null==r||!r.length)return;let i=r[0];const o=r.length>1?r[1]:null;let l=t.getCurrentMenuItem(i);if(l||(i=encodeURI(decodeURI(i)),l=t.getCurrentMenuItem(i)),!l)return;const s=l.shard,a=l.query,u=this._getPreviewItemUrl(i,o,a,t.hasCustomMenu);return{title:e.title,url:u,xpath:s,xquery:a,xfilters:o}}).filter(e=>!!e);null!=r&&r.length&&(e.data.brandPreviews=r)}return e},t._isXQueryContainsSort=function(e,t){if(t){return new URLSearchParams(e).has("sort")}return!1},t._getPreviewItemUrl=function(e,t,n,r){const i=this._isXQueryContainsSort(n,r);let o=new URLSearchParams(null!=t?t:"");return i?o.delete("sort"):o.has("sort")||o.set("sort","popular"),`${e}?${o=o.toString()}`},t._toBlock=function(e,t){return{blockId:t,type:e.type,columnNumber:e.columnnumber,data:this._convertToBlockModel(e)}},t._convertToBlockModel=function(e){switch(e.type){case this.enums.brandSchemeBlockType.menu:return e.items;case this.enums.brandSchemeBlockType.mixed:return this._getMixedBlock(e);case this.enums.brandSchemeBlockType.menuInfo:return this._getMenuInfo(e);case this.enums.brandSchemeBlockType.mainBanner:return this._getMainBanners(e);case this.enums.brandSchemeBlockType.preview:return this._getPreviewBlock(e);case this.enums.brandSchemeBlockType.header:return this._getHeaderBlock(e);case this.enums.brandSchemeBlockType.infoBlock:return this._getInfoBlock(e);case this.enums.brandSchemeBlockType.catalog:case this.enums.brandSchemeBlockType.filters:default:return null}},t._getInfoBlock=function(e){var t;return{infoBlockItems:null===(t=e.items)||void 0===t?void 0:t.filter(e=>!!e).map(e=>{const t=this._getInfoPageContentFromString(e.text);return{itemType:e.type,htmlPageContent:t}}),templateType:e.template}},t._getInfoPageContentFromString=function(e){const t=JSON.parse(e);return this._pageContentProcessing(t),t},t._pageContentProcessing=function(e){e&&e.forEach(e=>{var t;e&&"element"==e.type&&(e.tagType=this.enums.tagTypes[e.tagName],e.tagType||(e.tagName="span",e.tagType=this.enums.tagTypes[e.tagName]),(null===(t=e.children)||void 0===t?void 0:t.length)>0&&this._pageContentProcessing(e.children))})},t._getHeaderBlock=function(e){var t;return{headerItems:null===(t=e.items)||void 0===t?void 0:t.filter(e=>!!e).map(e=>({itemType:e.type})),templateType:e.template}},t._getPreviewBlock=function(e){var t;const n=e.template==this.enums.previewTemplateType.recent,r=null===(t=e.items)||void 0===t?void 0:t.filter(e=>!!e).map(e=>({title:e.title,url:n?"":e.url}));return{needFillXData:!n,brandPreviews:r,templateData:this._getPreviewTmplData(e.template)}},t._getPreviewTmplData=function(e){return{isCarousel:!1,showViewAllLink:!(e==this.enums.previewTemplateType.simpleNoLink||e==this.enums.previewTemplateType.recent),templateType:e}},t._getMainBanners=function(e){var t;const n=null===(t=e.items)||void 0===t?void 0:t.filter(e=>!!e).reduce((e,t)=>{const n=1==t.app_type?"d":226==t.app_type?"m":null;return n&&(e[n]=[...e[n]||[],this._getBannerItem(t)]),e},{});return{banners:n.d,mobileBanners:n.m,templateType:e.template}},t._getMenuInfo=function(e){var t;return{menuInfoItems:null===(t=e.items)||void 0===t?void 0:t.filter(e=>!!e).map(e=>({id:e.id,href:e.url,title:e.title})),templateType:e.template}},t._getMixedBlock=function(e){var t;return{mixedBlockItems:null===(t=e.items)||void 0===t?void 0:t.filter(e=>!!e).map(e=>({itemType:e.type,forMobile:226==e.app_type,banner:this._getBannerItem(e)})),templateType:e.template,title:e.title}},t._getBannerItem=function(e){return{id:e.bid,absoluteUrl:(e=>-1!=e.toLowerCase().indexOf("wildberries")?e:`https:${wb.settings.imagesSiteUrl}${e}`)(e.src),href:e.url,alt:e.title,src:e.src,target:"_self",link:((e,t)=>{const n=(t=decodeURI(t)).indexOf("#"),r=-1!=n?t.slice(0,n):t,i=-1!=n?t.slice(n):"";return`${r}${-1!=t.indexOf("?")?"&":"?"}bid=${e}${i}`})(e.bid,e.url),noFollow:!1,noIndex:!1}},e}();module.exports=e}();

},{}]},{},[3]);
