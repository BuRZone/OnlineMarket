(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function _defineProperties(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,_toPropertyKey(s.key),s)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var s=r.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}const CACHE=new Map,SuggestionsTypes=require("./suggestionsTypes");let SuggestionsExecutor=function(t){function e(e,r){var s;return(s=t.call(this)||this).type=r,s.settings=e,s.requestUrl=null,s}_inheritsLoose(e,t);var r=e.prototype;return r.loadSuggestionsAsync=async function(t){null==this.requestUrl&&(this.requestUrl=await this._createRequestUrl()),CACHE.has(this.settings.requestUrl)||CACHE.set(this.settings.requestUrl,new Map);const e=CACHE.get(this.settings.requestUrl);if(!e.has(t)){var r;if(this.requestUrl.searchParams.set(null!==(r=this.settings.queryName)&&void 0!==r?r:"query",t.trimLeft()),this.type==SuggestionsTypes.grouped){const t=await this._getGender(),e=WbSpaModel.prototype.$user.getLocale(),r=WbSpaModel.prototype.$helper.currentCulture;this.requestUrl.searchParams.set("gender",t),this.requestUrl.searchParams.set("locale",e),this.requestUrl.searchParams.set("lang",r)}const n=await this.$analitic.getSplitInfo();this.requestUrl.searchParams.set("TestID",n.splitId),this.requestUrl.searchParams.set("TestGroup",n.title);try{var s,i,o;const r=await this.$httpClient.fetchBasicJSON(this.requestUrl.toString(),{},{saveToBlob:"catalog"}),n=null!==(s=await(null===(i=(o=this.settings).dataProceeder)||void 0===i?void 0:i.call(o,r,t)))&&void 0!==s?s:r;e.set(t,{suggestions:n,type:this.type})}catch(t){return null}}return e.get(t)},r._getGender=async function(){switch(await WbSpaModel.prototype.$getUserGender()){case"Male":return"male";case"Female":return"female";default:return"common"}},r._createRequestUrl=async function(){var t;const e=null!==(t=this.settings.requestUrl)&&void 0!==t?t:await this.settings.urlCreator();return new URL(e,wb.settings.fullDomainName||window.location.origin)},e}(WbSpaModel),HistorySuggestionsExcecutor=function(){function t(t){this.historySearchCacheName=t.cacheKey,this.historiesLimit=t.historiesLimit,this._historySearch=null}var e=t.prototype;return e.loadSuggestionsAsync=function(t){let e=this.historySearch;if(t.length>0){const r=t.replace(wb.settings.regexp.escapingRegExp,"\\$&").trim(),s=new RegExp(`^${r}`);e=e.filter(t=>t.match(s))}const r=e.slice(0,5).map(e=>({name:e,type:SuggestionsTypes.history,search:e,typedText:t,searchParams:new URLSearchParams({search:e})}));return{type:SuggestionsTypes.history,suggestions:r}},e.saveHistorySearch=function(t){const e=this._makeSafeString(t);this._updateHistorySearch(e)},e.removeFromHistorySearch=function(t,e){e?this.historySearch=[]:t&&(this.historySearch=this.historySearch.filter(e=>e!=t))},e._makeSafeString=function(t){return t.replace(/<\/?[^>]+>/gi,"").trim()},e._getHistorySearchFromCache=function(){var t,e;return null!==(t=null===(e=localStorage)||void 0===e?void 0:e.getObject(this.historySearchCacheName))&&void 0!==t?t:[]},e._putHistorySearchToCache=function(t){var e;t&&(null===(e=localStorage)||void 0===e||e.putObject(this.historySearchCacheName,t))},e._updateHistorySearch=function(t){if(!t)return;const e=this.historySearch,r=e.findIndex(e=>e==t);r>=0&&e.splice(r,1),e.unshift(t),e.length>this.historiesLimit&&e.pop(),this.historySearch=e},_createClass(t,[{key:"historySearch",get:function(){return this._historySearch||(this._historySearch=this._getHistorySearchFromCache()),this._historySearch},set:function(t){const e=this._putHistorySearchToCache(t);this._historySearch=e}}]),t}();function suggestionsExecutorFactory(t,e){switch(e){case SuggestionsTypes.history:return new HistorySuggestionsExcecutor(t);default:return new SuggestionsExecutor(t,e)}}module.exports=suggestionsExecutorFactory;

},{"./suggestionsTypes":3}],2:[function(require,module,exports){
"use strict";function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}!function(){const e=require("./suggestionsTypes"),t=require("./suggestionsExecutor");let r=function(){function r(){this.executors=new Map}var o=r.prototype;return o.addExecutor=function(e,t){this.executors.set(t,e)},o.loadSuggestionsAsync=async function(e,t=null){if(null!=t&&this.executors.has(t)){const r=this.executors.get(t).loadSuggestionsAsync(e);if(null!=r&&r.suggestions.length)return[r]}let r=await Promise.all(this.executors.map(t=>t.loadSuggestionsAsync(e)).toArray()),o=(r=r.filter(e=>null!=e)).find(e=>5===e.type);if(o){o=JSON.parse(JSON.stringify(o)),r=r.filter(e=>5!==e.type);const e=o.suggestions.find(e=>6===e.type);e&&(e.forEmptySearch=!0),r.push(...o.suggestions)}return r.filter(e=>null!=e)},o.saveHistorySearch=function(t){var r;null===(r=this.executors.get(e.history))||void 0===r||r.saveHistorySearch(t)},o.removeFromHistorySearch=function(t,r){var o;null===(o=this.executors.get(e.history))||void 0===o||o.removeFromHistorySearch(t,r)},r.createSuggestionsHelper=function(e=[]){const o=new r;return e.forEach(([e,r])=>{try{const i=t(e,r);o.addExecutor(i,r)}catch(e){console.error(e)}}),o},_createClass(r,null,[{key:"suggestionsTypes",get:function(){return e}}]),r}();window.__spaModuleManager__.register("suggestionsHelper",r)}();

},{"./suggestionsExecutor":1,"./suggestionsTypes":3}],3:[function(require,module,exports){
"use strict";module.exports=Object.freeze({history:0,catalog:1,brands:2,subjects:3,goods:4,grouped:5,tags:6});

},{}]},{},[2]);
