!function(){"use strict";function t(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(t);o<i.length;o++)e.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(t,i[o])&&(n[i[o]]=t[i[o]])}return n}var e="_wbauid",n="user_id",i="goal_reach";(new(function(){function o(){this._ecCurrency="",this._ecProductItems=null,this._debugMode=!1}return o.prototype.init=function(){var t=this;this.initTime=window.wba.l;var e=window.wba.q;Array.isArray(e)&&e.forEach((function(e){t.HandleCmd(e[0],e[1])})),window.wba=this.HandleCmd.bind(this)},o.prototype.initUserId=function(t){var e=this.getUserID();(""===e||t)&&(e=this.genNewUserID(),this.isNewUser=!0),this.userId=e},o.prototype.getUserID=function(){return document.cookie.split(";").map((function(t){return t.trim()})).filter((function(t){return"_wbauid="===t.substring(0,e.length+1)})).map((function(t){return t.substring(e.length+1)}))[0]||""},o.prototype.HandleCmd=function(t,e){null==e&&(e={});try{switch(t){case"init":this.HandleInitCmd(e);break;case n:this.HandleSetClientIdCmd(e);break;case i:this.HandleGoalReachCmd(e);break;case"ec:send":this.ECHandleSendCmd(e);break;case"ec:addProduct":this.ECHandleAddProductCmd(e);break;case"ec:setCurrency":this.ECHandleSetCurrencyCmd(e);break;case"ec:setAction":this.ECHandleSetActionCmd(e);break;case"ec:clear":this.ECClear();break;default:this.HandleSimpleEvent(t,e)}}catch(e){try{this.isDebugMode()&&console.error("An error occurred while handling '"+t+"' command:\n\t"+e)}catch(t){}}},o.prototype.genNewUserID=function(){var t=Math.floor((new Date).getTime()/1e3),e=Math.floor(Math.random()*Math.pow(2,30)).toString()+t.toString(),n=new Date;return n.setTime(n.getTime()+31536e6),document.cookie="_wbauid="+e+"; expires="+n.toUTCString()+"; path=/; domain="+this._cookieDomain,e},o.prototype.HandleSimpleEvent=function(t,e){this.SendEvent(t,this.BuildStatParams(),{cp:e})},o.prototype.ECClear=function(){this._ecAction=null,this._ecProductItems=null},o.prototype.ECPrepareJSON=function(){var t={};return null==this._ecAction?t.action={type:"unspecified",currency:this._ecCurrency}:t.action=this._ecAction,null!=this._ecProductItems&&(t.products=this._ecProductItems),t},o.prototype.ECHandleAddProductCmd=function(t){null==this._ecProductItems&&(this._ecProductItems=[]),null==t.inListIndex&&null!=t.position&&(t.inListIndex=t.position,delete t.position),null!=t.list&&(null==t.listID&&(t.listID=t.list),null==t.listName&&(t.listName=t.list),delete t.list),this._ecProductItems.push(t)},o.prototype.ECHandleSendCmd=function(t){var e=this.ECPrepareJSON();e.cp=t,this.ECClear(),this.SendEvent("ec",this.BuildStatParams(),e)},o.prototype.ECHandleSetCurrencyCmd=function(t){this._ecCurrency=t,null!=this._ecAction&&(this._ecAction.currency=t)},o.prototype.ECHandleSetActionCmd=function(t){"object"==typeof t?this._ecAction=t:(null==this._ecAction&&(this._ecAction={}),this._ecAction.type=t),this._ecAction.currency=this._ecCurrency},o.prototype.HandleSetClientIdCmd=function(e){var i=e.clientId,o=t(e,["clientId"]);this.clientId=i,this.SendEvent(n,this.BuildStatParams(),{cp:o})},o.prototype.HandleInitCmd=function(t){this.counterId=t.counterId,this.clientId=t.clientId,this._debugMode=!0===t.debugMode;var e=t.cookieDomain;"string"==typeof e&&0!==e.length?this._cookieDomain=e:this._cookieDomain=window.location.hostname;var n=t.resetUserId;if(this.initUserId("boolean"==typeof n&&n),this._debugMode)try{console.log("Initialization done:\n\tthis.counterId='"+this.counterId+"'\n\tthis.userId='"+this.userId+"'\n\tthis.clientId='"+this.clientId+"'\n\tthis._debugMode='"+this._debugMode+"'\n\tthis._cookieDomain='"+this._cookieDomain+"'\n\tSDKVersionBuildNum='324'")}catch(t){}},o.prototype.HandleGoalReachCmd=function(e){var n=e.name,o=e.price100,r=e.currency,c=t(e,["name","price100","currency"]),s=this.BuildStatParams();s.gn=n,s.gp100=o,s.gcr=r,this.SendEvent(i,s,{cp:c})},o.prototype.BuildStatParams=function(){var t={};t.t=document.title.substring(0,500),t.u=document.URL,t.cid=this.counterId,t.s=this.GetScreenInfo(),t.w=this.GetWindowInfo(),t.user_id=this.userId,t.vbn="324",this.clientId&&(t.client_id=this.clientId);var e=document.referrer.trim();return e.length>0&&(t.r=e),this.isNewUser&&(t.nu=1),t},o.prototype.GetScreenInfo=function(){return(0|window.screen.width*(window.devicePixelRatio||1))+"x"+(0|window.screen.height*(window.devicePixelRatio||1))+"x"+(0|window.screen.colorDepth)},o.prototype.GetWindowInfo=function(){return(0|(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth))+"x"+(0|(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight))},o.prototype.SendEvent=function(t,e,n){void 0===n&&(n={});var i=[];Object.keys(e).forEach((function(t){var n=e[t];null!=n&&i.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}));var o=i.join("&"),r="https://a.wb.ru/e/"+encodeURIComponent(t)+"?"+o,c=JSON.stringify(n);this.sendData(r,c)},o.prototype.sendAsXHR=function(t,e){var n=new XMLHttpRequest;n.open("POST",t),n.setRequestHeader("Content-Type","text/plain"),n.send(e)},o.prototype.sendAsBeacon=function(t,e){var n=new window.Blob([e],{type:"text/plain"});try{if(window.navigator.sendBeacon(t,n))return}catch(t){}this.sendAsXHR(t,e)},o.prototype.sendData=function(t,e){window&&window.navigator&&"function"==typeof window.navigator.sendBeacon&&"function"==typeof window.Blob?this.sendAsBeacon(t,e):this.sendAsXHR(t,e)},o.prototype.isDebugMode=function(){if(this._debugMode)return!0;try{return window.location.href.indexOf("_adebug=1")>=0}catch(t){return!1}},o}())).init()}();

