(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}let FeedbacksCarousel=function(e){function t(o,r,i,s){var a;return(a=e.call(this)||this).imtId=o,a.votes=i,a.feedbacks=t.proceedFeedbacks(r,i),a.totalCount=s,a.hasMore=s>a.feedbacks.length,a}_inheritsLoose(t,e),t.proceedFeedbacks=function(e,o){return Array.isArray(e)?e.filter(e=>e.photo||""!==e.text).map(e=>{var r,i,s,a,n,d;return{id:e.id,userName:e.wbUserDetails.name,personalPhoto:$.views.helpers.PersonalPhoto(e.wbUserId,e.wbUserDetails.hasPhoto),userId:e.wbUserId,country:null!==(r=null===(i=e.wbUserDetails.country)||void 0===i?void 0:i.toLowerCase())&&void 0!==r?r:"",feedbackDate:new Date(e.createdDate).format("dd MMMM yyyy, HH:mm"),productValuation:e.productValuation,productSize:e.size,productSizeMatch:e.matchingSize&&t.proceedSizeValuation(e.matchingSize),productColor:e.color,text:null==e?void 0:e.text,photos:e.photos,photo:e.photo,votesUp:null!==(s=null===(a=e.votes)||void 0===a?void 0:a.pluses)&&void 0!==s?s:0,votesDown:null!==(n=null===(d=e.votes)||void 0===d?void 0:d.minuses)&&void 0!==n?n:0,voted:"plus"==o[e.id]?1:"minus"==o[e.id]?-1:null,star:e.productValuation}}):[]},t.proceedSizeValuation=function(e){switch(e){case"smaller":return WbSpaModel.prototype.$localziation.sizeMatchSmall;case"bigger":return WbSpaModel.prototype.$localziation.sizeMatchBig;default:return WbSpaModel.prototype.$localziation.sizeMatchOk}};var o=t.prototype;return o.leaveCommentComplaint=function(e){const{data:t}=$.view(e.currentTarget);t&&this.$moduleLoader.loadModuleAsync("feedbackComplaintPopup").then(e=>{e.showPopup(t.id)})},o.vote=function(e,t){const{data:o}=$.view(t.currentTarget);if(o&&!o.voted)return this.$analitic.sendEvent(e>0?"Item_Feedback_Like_T":"Item_Feedback_Dislike_T",{}),this.$httpClient.fetchJSON("/webapi/product/comments/vote",{method:"POST",body:new URLSearchParams({id:o.id,vote:e,link:this.imtId})},{redirectUnauth:!0}).then(()=>{var t;$.observable(o).setProperty({voted:e>0?1:-1,votesUp:o.votesUp+(e>0?1:0),votesDown:o.votesDown+(e>0?0:1)}),this.votes[o.id]=e>0?"plus":"minus",null===(t=this.$services.productFeedbacksService)||void 0===t||t.voteUpdate(this.imtId,o.id,e)})},o.goToProfile=function(e){return!1},o.showFeedbackPhotos=function(e){const{data:t}=$.view(e.currentTarget);if(!t)return;const o=e.currentTarget.closest(".j-feedback-slide"),{data:r}=$.view(o);if(!r)return;const i=r.photo.findIndex(e=>e===t);this.$moduleLoader.loadModuleAsync("photoGalleryViewer").then(e=>{const t=$.views.helpers.fillFeedbackPhotos(r.photo);(new e).showCompositeSwiper(t,i,!1,{classList:["goods-photo"]})})},t}(WbSpaModel);module.exports=FeedbacksCarousel;

},{}],2:[function(require,module,exports){
"use strict";function _defineProperties(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var i=o.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}!function(){const e=require("./feedbacksCarousel");let t=function(){function t(t,o,i,s,n,r){this.parentId=t,this.nmId=o.nmId,this.imtId=o.imtId,this.chrtId=o.chrtId,this.productModel=o,this.feedbacksCarousel=new e(this.imtId,i.feedbacks,n.votes,i.summaryModel.totalCount),this.summaryModel=i.summaryModel,this.galleryModel=s,this.rawData=n,this.statsModel=r,this.swiper=null,this.showCommentPopup=this.showCommentPopup.bind(this),this.allFeedbacksLink=this.allFeedbacksLink.bind(this),this.beforeAllFeedbacksTransition=this.beforeAllFeedbacksTransition.bind(this),this.onSizeUpdated=this.onSizeUpdated.bind(this),this.onColorChanged=this.onColorChanged.bind(this),this.onProductChanged=this.onProductChanged.bind(this),this.allFeedbacksLink.depends=["nmId","chrtId"]}var o=t.prototype;return o.init=function(){this.initCarousel(),this.galleryModel.initCarousel(),this._bindEvents()},o.destroy=function(){var e;null===(e=this.swiper)||void 0===e||e.destroy(),this._unbindEvents()},o.onSizeUpdated=function(e){const{nmId:t,selectedSize:o}=e.detail;this.nmId==t&&$.observable(this).setProperty({chrtId:o})},o.onColorChanged=function(e){var t;const{sourceId:o,sourceNmId:i,selectedNomenclature:s}=e.detail;o==this.parentId&&i==this.nmId&&$.observable(this).setProperty({nmId:s.nmId,chrtId:null===(t=s.selectedSize)||void 0===t?void 0:t.characteristicId})},o.onProductChanged=function(e){const{sourceId:t,sourceNmId:o}=e.detail;t==this.parentId&&o==this.nmId&&this.destroy()},o.allFeedbacksLink=function(){return`/catalog/${this.nmId}/feedbacks?imtId=${this.imtId}${this.chrtId?`&size=${this.chrtId}`:""}`},o.beforeAllFeedbacksTransition=function(e){var t;const o={location:"true"==e.currentTarget.dataset.seeAll?"view_all_reviews":"user_review",count_reviews:this.summaryModel.totalCount||0};null===(t=this.statsModel)||void 0===t||t.sendClickEvent("Item_Feedback",o),this.$services.productFeedbacksService.saveFeedbacksModelToCache(this.imtId,this.rawData)},o.initCarousel=function(){const e=document.querySelector(".j-feedbacks-swiper-carousel .swiper-container");e&&(this.swiper=new Swiper(e,{slidesPerView:"auto",watchOverflow:"true",spaceBetween:8,navigation:{nextEl:e.parentElement.querySelector(".swiper-button-next"),prevEl:e.parentElement.querySelector(".swiper-button-prev")},breakpoints:{1024:{spaceBetween:24}}}),this.$helper.nextTick().then(()=>{e.querySelectorAll(".j-feedback-text").forEach(e=>{var t;e.scrollHeight>e.clientHeight&&(null===(t=e.querySelector(".j-show-more-btn"))||void 0===t||t.classList.remove("hide"))})}))},o.showSummaryPopup=function(){Promise.all([this.$moduleLoader.loadModuleAsync("mobileSummaryPopup"),$.views.loadTemplateAsync("feedbacksValuationDistribution"),$.views.loadTemplateAsync("sizeMatchDistribution")]).then(([e])=>{e.showPopup(this)})},o.showCommentPopup=function(){const e={location:"Item",item_id:this.nmId};this.$analitic.sendEvent("Item_Feedback_GiveFeedback_T",e),Promise.all([this.$httpClient.fetchJSON(`/webapi/product/comments/goods?nmId=${this.nmId}`,{method:"POST"},{redirectUnauth:!0}),this.$moduleLoader.loadModuleAsync("feedbacksEditor"),this.$moduleLoader.loadModuleAsync("imageUploader")]).then(([t,o,{ImageUploader:i}])=>{o.showFeedbacksPopup(this.imtId,this.productModel,t,new i(o.imageLoaderSettings),e)}).catch(e=>{if(!e.isUnauthorize)return e.isCustomError?$.views.loadTemplateAsync("popuperrorunbuy").then(t=>{wb.popup.showCustomPopup({useHtml:!0,msg:t.render({errorMessage:e.message}),popupClassesList:["popup-error-unbuy","shown"],contentClasses:["popup__content"],useCenteredFunction:!0,modal:!0})}):void $.views.loadTemplateAsync("feedbacksubmiterror").then(e=>{if(!e)return Promise.reject();wb.popup.showCustomPopup({useHtml:!0,msg:e.render(),popupClassesList:["popup-alert","popup-error-feedbacks","shown"],contentClasses:["popup__content"],useCenteredFunction:!0,modal:!1})}).catch(e=>{wb.popup.renderModalError(this.$localziation.serverError)})})},o._bindEvents=function(){this.$eventBus.addEventListener("ProductSizeUpdated",this.onSizeUpdated),this.$eventBus.addEventListener("ProductColorChanged",this.onColorChanged),this.$eventBus.addEventListener("ProductChanged",this.onProductChanged)},o._unbindEvents=function(){this.$eventBus.removeEventListener("ProductSizeUpdated",this.onSizeUpdated),this.$eventBus.removeEventListener("ProductColorChanged",this.onColorChanged),this.$eventBus.removeEventListener("ProductChanged",this.onProductChanged)},_createClass(t,[{key:"template",get:function(){return t.template}},{key:"hasFeedbacks",get:function(){return this.summaryModel.totalCount>0}}]),t}();window.__spaModuleManager__.register("productFeedbacksModel",t)}();

},{"./feedbacksCarousel":1}]},{},[2]);
