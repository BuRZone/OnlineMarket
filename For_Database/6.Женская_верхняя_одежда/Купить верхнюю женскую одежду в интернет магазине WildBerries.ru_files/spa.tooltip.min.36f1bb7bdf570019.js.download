!function(t){"use strict";t.views&&t.views.tags({tooltip:{dataBoundOnly:!0,boundProps:["text"],tooltipClass:"tooltip",init:function(){this.settings={delay:0,dist:10,distAlignBy:0,responsive:!0},this.text=this.tagCtx.props.text,this.tmplName=this.tagCtx.props.tmplName,this.tmplData=this.tagCtx.props.tmplData,this.contentSlr=this.tagCtx.props.contentSlr,this.classList=(null==(t=this.tagCtx.props.classes)?void 0:t.split(" "))||[],this.useBinding=this.tagCtx.props.useBinding,this.overlay=this.tagCtx.props.overlay,this.tagCtx.props.hasOwnProperty("distance")&&(this.settings.dist=this.tagCtx.props.distance),this.tagCtx.props.hasOwnProperty("distanceAlignBy")&&(this.settings.distAlignBy=this.tagCtx.props.distanceAlignBy),this.tagCtx.props.hasOwnProperty("delay")&&(this.settings.delay=this.tagCtx.props.delay),this.responsive=this.settings.responsive,this.tagCtx.props.hasOwnProperty("responsive")&&(this.responsive=this.tagCtx.props.responsive);var t=this.tagCtx.props.pos||"center top";this.posHorizontal=t.split(" ")[0],this.posVertical=t.split(" ")[1],this.linkedElMarkup=this.linkCtx.elem.innerHTML,this.rightCollision=this.tagCtx.props.rightCollision,this.disabled=this.tagCtx.props.disabled,this.preventDefault=this.tagCtx.props.preventDefault,this.stopPropagation=this.tagCtx.props.stopPropagation,this.popupMode=this.responsive&&"m"===wb.settings.displayMode,this.showTooltip=!1,this.closeOnDisable=this.tagCtx.props.closeOnDisable},onUpdate:function(){if(!this.closeOnDisable)return!1;this.disabled&&this._destroy()},onAfterChange:function(){this.text=this.tagCtx.props.text},onBind:function(){if(this.disabled)return!1;this._bindEvents()},onUnbind:function(){this._destroy()},_bindEvents:function(){"always"==this.tagCtx.props.trigger?this._positionAt.call(this):"click"==this.tagCtx.props.trigger||this.popupMode?this.linkCtx.elem.addEventListener("click",this._positionAt.bind(this)):"Shown"==this.tagCtx.props.trigger?(this.linkCtx.elem.addEventListener("Shown",this._positionAt.bind(this)),this.linkCtx.elem.addEventListener("Unshown",this._destroy.bind(this))):(this.linkCtx.elem.addEventListener("mouseover",this._positionAt.bind(this)),this.linkCtx.elem.addEventListener("mousemove",this._positionAt.bind(this)),this.linkCtx.elem.addEventListener("mouseout",t=>{this.linkCtx.elem.contains(t.relatedTarget)||setTimeout(()=>{this.insideTip||this._destroy()},this.settings.delay)}))},_destroy:function(){var t;document.removeEventListener("click",this),!this.popupMode&&this.tooltip&&document.body.removeChild(this.tooltip),(this.tooltip=null)!=(t=this.overlayEl)&&t.remove(),this.showTooltip=!1},async _getMarkup(){return this.contentSlr?{html:document.querySelector(this.contentSlr).innerHTML}:(this.tmplName&&!t.templates[this.tmplName]&&await t.views.loadTemplateAsync(this.tmplName),this.tagCtx.props.useBind&&this.tmplName?{bound:!0,link:t.link[this.tmplName]}:this.tmplName?{html:t.templates[this.tmplName].render(this._getTmplData(),this.tagCtx.props.tmplHelper)}:this.text?{html:`<div class="tooltip__content">${this.text}</div>`}:null)},handleEvent:function(t){"click"!=t.type||this.linkCtx.elem.contains(t.target)||this.tooltip.contains(t.target)||this._destroy()},_getTmplData:function(){return"function"==typeof this.tmplData?this.tmplData():this.tmplData},async _positionAt(e){if("click"==this.tagCtx.props.trigger&&this.stopPropagation&&e.stopImmediatePropagation(),this.showTooltip&&"click"==this.tagCtx.props.trigger)return this._destroy();if(!this.tooltip){this.showTooltip=!0;const p=await this._getMarkup();if(p)if(this.showTooltip)if(this.popupMode)this.preventDefault&&e.preventDefault(),this.stopPropagation&&e.stopPropagation(),(e={lockScroll:!0,modal:!1,showCloseBtn:"always"!=this.tagCtx.props.trigger,useHtml:!0,contentClasses:["content"],popupClassesList:["shown","tooltip","tooltip--mobile",...this.classList],useCenteredFunction:!0,onShow:t=>t.classList.remove("popup")}).onHide=()=>{var t,i;null!=(t=this.tagCtx.props.tmplHelper)&&null!=(i=t.onPopupHide)&&i.call(t),this._destroy()},p.bound?e.onShow=t=>{t.classList.remove("popup"),p.link(t.querySelector(".content"),this._getTmplData(),{...this.tagCtx.props.tmplHelper,close:()=>this.tooltip.close()})}:e.msg=p.html,this.tooltip=wb.popup.showCustomPopup(e);else{document.querySelectorAll("."+this.tooltipClass).forEach(t=>{var i;return null==(i=t.close)?void 0:i.call(t)}),this.tooltip=document.createElement("div"),this.tooltip.style.display="inline-block",this.tooltip.style.position="absolute",this.tooltip.style.zIndex="11111",this.tooltip.style.width=this.tagCtx.props.width,p.bound?(e=this.tagCtx.view,p.link(this.tooltip,this._getTmplData(),{parentView:e,...this.tagCtx.props.tmplHelper,close:this._destroy.bind(this)})):this.tooltip.innerHTML=p.html,this.tooltip.classList.add(this.tooltipClass),this.tooltip.classList.addMany(this.classList),this.tooltip.close=()=>this._destroy(),"click"!=this.tagCtx.props.trigger&&(this.tooltip.addEventListener("mouseenter",()=>this.insideTip=!0),this.tooltip.addEventListener("mouseleave",()=>{this.insideTip=!1,setTimeout(()=>{this.insideTip||this._destroy()},this.settings.delay)})),"click"==this.tagCtx.props.trigger&&document.addEventListener("click",this),this.overlay&&(this.overlayEl=document.createElement("div"),this.overlayEl.classList.addMany(["overlay","j-custom-overlay"]),document.body.appendChild(this.overlayEl)),document.body.appendChild(this.tooltip);let t=this.linkCtx.elem.getBoundingClientRect(),i,s;var o=(t,i)=>{if(this.tagCtx.props.alignBy){var s=this.linkCtx.elem.closest(this.tagCtx.props.alignBy);if(s)return parseInt(s.getBoundingClientRect()[i])+this.settings.distAlignBy}return parseInt(t)};switch(this.posHorizontal){case"left":i=parseInt(t.left)-this.settings.dist-this.tooltip.offsetWidth,parseInt(t.left)-this.tooltip.offsetWidth<0&&(i=this.settings.dist);break;case"right":i=t.right+this.settings.dist,parseInt(t.right)+this.tooltip.offsetWidth>document.documentElement.clientWidth&&(i=document.documentElement.clientWidth-this.tooltip.offsetWidth-this.settings.dist);break;case"alignleft":i=o(t.left,"left");var n=document.documentElement.clientWidth-(i+this.tooltip.offsetWidth);n<0&&(i+=n);break;case"alignright":i=o(t.right,"right")-this.tooltip.offsetWidth;break;case"aligncenter":var n=o(t.left,"left"),l=o(t.left,"right");i=(n+l)/2-this.tooltip.offsetWidth/2;break;default:i=parseInt(t.left)+((null!=(n=this.linkCtx.elem.offsetWidth)?n:t.width)-this.tooltip.offsetWidth)/2;l=parseInt(t.right)+this.tooltip.offsetWidth/2-document.documentElement.clientWidth;0<l&&(i-=l+this.settings.dist)}switch(this.posVertical){case"center":s=(parseInt(t.top)+parseInt(t.bottom))/2-this.tooltip.offsetHeight/2;break;case"bottom":s=parseInt(t.bottom)+this.settings.dist,parseInt(t.bottom)+this.tooltip.offsetHeight>document.documentElement.clientHeight&&(s=parseInt(t.top)-this.tooltip.offsetHeight-this.settings.dist);break;default:s=parseInt(t.top)-this.tooltip.offsetHeight-this.settings.dist}i=i<0?parseInt(t.left):i,s=s<0?parseInt(t.bottom)+this.settings.dist:s,this.tooltip.style.left=i+"px",this.tooltip.style.top=s+pageYOffset+"px"}}}}})}(this.jQuery);