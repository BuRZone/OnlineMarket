(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";!function(){const e={},t=36e5,i="ru"===wb.settings.currentLocale?507:null;function r(i,r){e[i]=r,setTimeout(()=>{delete e[i]},t)}let n=function(){function t(){}var n=t.prototype;return n.getDeliveryInfoAsync=async function(){const t=await this.$user.getLocationData(),i=`${t.latitude};${t.longitude}`;return e[i]||r(i,this._getDeliveryInfoAsync(t)),await e[i]},n.getExpressStoreAsync=async function(){const t=await this.$user.getLocationData(),i=`express;${t.latitude};${t.longitude}`;if(!e[i]){r(i,await this.$httpClient.fetchJSON("/webapi/spa/product/expressstore?latitude="+t.latitude+"&longitude="+t.longitude))}return e[i]},n.getDeliveryStoreId=async function(e){var t;const r=await this.getDeliveryInfoAsync();if(null==r||!r.delivery)return i;if(!Array.isArray(r.delivery.times)||r.delivery.times.length<1)return i;const n=r.delivery.times,s=e?n.filter(t=>e.some(e=>e==t.storeId)):[];if(0===s.length)return i;return null!==(t=s.reduce((e,t)=>!e.inMinutes||t.inMinutes&&t.inMinutes<e.inMinutes?t:t.inMinutes===e.inMinutes&&(!e.priority||t.priority&&t.priority<e.priority)?t:e).storeId)&&void 0!==t?t:i},n.getDeliveryModel=function(e,t,i=null,r=null,n=null,s=!1){if(null==e||!e.delivery)return null;if(!Array.isArray(t)||t.length<1)return null;const o={cityName:e.cityName};if(!Array.isArray(e.delivery.times)||e.delivery.times.length<1)return o;const l=e.delivery.times.filter(e=>t.some(t=>t==e.storeId));if(0===l.length)return;let a;i&&(a=l.find(e=>e.storeId==i)),a||(a=l.reduce((e,t)=>!e.inMinutes||t.inMinutes&&t.inMinutes<e.inMinutes?t:t.inMinutes===e.inMinutes&&(!e.priority||t.priority&&t.priority<e.priority)?t:e)),o.storeId=a.storeId,o.storeName=this.$services.storeService.names[o.storeId]||a.storeName,o.deliveryOption=Object.keys(l.reduce((e,t)=>(e[t.deliveryOption]=!0)&&e,{})).join(", ");const u=new Date(a.closestDeliveryDate);var d;if(o.isExpress=!!a.expressDeliveryDate,o.minDate=u,u>0)if(a.expressDeliveryDate){const e=r;o.closestDeliveryDate=e?this._estimatedDeliveryExpressTimeText(e,a.expressInfo):a.expressDeliveryDate}else if(null!==(d=a.isSupposedDate)&&void 0!==d&&d){const e=null!=n?n:r;o.closestDeliveryDate=this._estimatedDeliveryDateText(e,a.inDays,a.extraDays)}else o.closestDeliveryDate=new Date(u).format("dd MMMM").toLowerCase();else o.closestDeliveryDate=null;return o.isCargo=!!a.isCargo,o.sellerDelivery=!!a.isDbs,o.isImport=s,o},n.getStoreById=async function(e){const t=null!=e?e:i;return(await this.getDeliveryInfoAsync()).delivery.times.find(e=>e.storeId==t)},n._getDeliveryInfoAsync=async function(e){var t,i;const r=await this.$httpClient.fetchJSON(`/webapi/spa/product/deliveryinfo?latitude=${e.latitude}&longitude=${e.longitude}`,{method:"POST"});return r.stores={cargo:(null==r||null===(t=r.times)||void 0===t||null===(t=t.filter(e=>e.isCargo))||void 0===t?void 0:t.map(e=>e.storeId))||[],computedDelCostStores:(null==r||null===(i=r.times)||void 0===i||null===(i=i.filter(e=>e.cdc))||void 0===i?void 0:i.map(e=>e.storeId))||[]},{cityName:e.address,delivery:r}},n._estimatedDeliveryDateText=function(e,t,i){let r;if(e?(r=new Date(Date.now()+60*e*60*1e3)).getHours()>=23&&r.setDate(r.getDate()+1):t&&(r=new Date(Date.now()+24*t*60*60*1e3)),r.is1stJan()&&r.setDate(r.getDate()+1),i>0){const e=new Date(r);e.setDate(r.getDate()+i),e.is1stJan()&&e.setDate(e.getDate()+1);const t=r.getMonth()===e.getMonth()?"d":"d MMMM";return r.format(t)+"-"+e.format("d MMMM")}return r.format("d MMMM")},n._estimatedDeliveryExpressTimeText=function(e,t){const i=new Date(Date.now()+60*e*60*1e3);if(!t.anyTime){const e=new Date(Date.now());if(e.setHours(...t.fromTime.split(":").map(e=>parseInt(e))),i<e)return"Сегодня утром";if(e.setHours(...t.toTime.split(":").map(e=>parseInt(e))),i>e)return"Завтра утром"}return`${$.pluralize(e,"за час","за {0} часа","за {0} часов")}`},t}();window.__spaServiceManager__.register("deliveryInfoService",n)}();

},{}]},{},[1]);
