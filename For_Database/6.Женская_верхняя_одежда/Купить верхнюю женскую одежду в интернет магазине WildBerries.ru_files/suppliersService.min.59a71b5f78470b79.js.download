(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";const SupplierInfoCache=require("./supplierInfoCache"),BOOKING_SUPPLIERS=[228823,254312,293891,332604,368502,390150,403725,406583,431264,466840,466857,512928,603972,332458];let SupplierExtInfo=function(e){var t,i,s;this.rating=e.valuation,this.feedbacks=null!==(t=e.feedbacksCount)&&void 0!==t?t:0,e.ratingIsInvisible||(this.percent=Math.round(10*e.rating)/10),this.registrationDate=e.registrationDate,this.saleItemQuantity=null!==(i=e.saleItemQuantity)&&void 0!==i?i:0,this.hasLogo=e.hasLogo,this.hasBanner=e.hasBanner,this.v=SupplierInfoCache.cacheVersion;const{months:n,years:a}=wb.helpers.date.diff(new Date(this.registrationDate));this.isNewSupplier=0==n&&0==a,this.id=e.id,this.hideSellsCount=BOOKING_SUPPLIERS.includes(this.id);const r=null===(s=e.defectPercent)||void 0===s?void 0:s.toFixed(1);r&&(this.defectPercent=parseFloat(r)),this.deliveryDuration=e.deliveryDuration>0?e.deliveryDuration:null};module.exports=SupplierExtInfo;

},{"./supplierInfoCache":3}],2:[function(require,module,exports){
"use strict";function _defineProperties(e,r){for(var t=0;t<r.length;t++){var i=r[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var r=_toPrimitive(e,"string");return"symbol"==typeof r?r:String(r)}function _toPrimitive(e,r){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}const ORG_FORMS=["ООО","ПАО","ОАО","ЗАО","ИП","Фонд","Ассоциации","Союзы","НАО","ТОО","АО"];let SupplierInfo=function(){function e(e){var r,t;this.nmId=e.nmId,this.legalAddress=e.legalAddress,this.ogrn=e.ogrn,this.ogrnip=e.ogrnip,this.supplierName=e.supplierName,this.supplierId=e.supplierId,this.trademark=this.isDefaultSupplier?"WILDBERRIES":(null!==(r=e.trademark)&&void 0!==r?r:"").length>0?e.trademark:e.supplierName,this.dt=null!==(t=e.dt)&&void 0!==t?t:Date.now(),this.extInfo=e.extInfo,this.shopName=e.shopName,this.logoUrl=e.logoUrl,this.shopId=e.shopId}return _createClass(e,[{key:"isDefaultSupplier",get:function(){return 32477==this.supplierId||12399==this.supplierId}},{key:"orgForms",get:function(){return ORG_FORMS}}]),e}();module.exports=SupplierInfo;

},{}],3:[function(require,module,exports){
"use strict";function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}const CACHE_VERSION="v5",SUPPLIERS_EXT_CACHE_KEY="suppliersInfo",SUPPLIERS_CACHE_TTL=72e5,SUPPLIERS_CACHE_KEY="product_supliers",MAX_CACHE_AGE=432e6,MAX_CACHE_SIZE=255,MULTISHOP_SUPPLIERS_CACHE_KEY="multiShopSuppliers",MULTISHOP_SUPPLIERS_CACHE_TTL=36e5;let SupplierInfoCache=function(){function e(){}return e.getSuppliersFromCache=function(){try{var e;const t=Date.now(),r=null!==(e=localStorage.getObject("product_supliers"))&&void 0!==e?e:{};return Object.entries(r).filter(([e,r])=>r.dt+432e6>t).reduce((e,[t,r])=>(e[t]=r,e),{})}catch(e){return console.error("[ProductSuppliersCache]: failed to read from local storage",e),{}}},e.setSuppliersToCache=function(t){const r=Date.now(),o=e.getSuppliersFromCache();let l=Object.values(o).filter(e=>e.dt+432e6>r);l.length>255&&(l=l.slice(0,255));const n=l.reduce((e,t)=>(e[t.nmId]=t,e),{});t.forEach(e=>n[e.nmId]=e);try{localStorage.putObject("product_supliers",n)}catch(e){console.error("[ProductSuppliersCache]: failed to save from local storage",e)}},e.getExtFromCache=function(e){var t;const r=localStorage.getObject("suppliersInfo");if(!r)return null;const o=r[e];return o?Date.now()>(null!==(t=o.t)&&void 0!==t?t:0)||"v5"!=o.v?(delete r[e],localStorage.putObject("suppliersInfo",r),null):o:null},e.setExtToCache=function(e,t){var r;if(!(e>0&&t))return;const o=null!==(r=localStorage.getObject("suppliersInfo"))&&void 0!==r?r:{};o[e]={...t,t:Date.now()+72e5},localStorage.putObject("suppliersInfo",o)},e.getMultishopSuppliersFromCache=function(){var e;const t=localStorage.getObject("multiShopSuppliers");return!t||Date.now()>(null!==(e=t.t)&&void 0!==e?e:0)?null:t.suppliers},e.setMultishopSuppliersToCache=function(e){(null==e?void 0:e.length)>0&&localStorage.putObject("multiShopSuppliers",{suppliers:e,t:Date.now()+36e5})},_createClass(e,null,[{key:"cacheVersion",get:function(){return"v5"}}]),e}();module.exports=SupplierInfoCache;

},{}],4:[function(require,module,exports){
"use strict";!function(){const e=require("./supplierInfo"),t=require("./supplierExtInfo"),i=require("./supplierInfoCache");let s=function(){function s(){}var l=s.prototype;return l.getSellersAsync=async function(t,i){this.suppliersList||(this.suppliersList=await this._getMultishopSuppliers());let s=await Promise.all(t.map(e=>this._loadBasicSupplierInfoAsync(e,this.suppliersList)));if(s=s.filter(e=>null!=e),i){const e=await this.getSuppliersExtInfo(s.map(e=>e.supplierId));(null==e?void 0:e.length)>0&&s.forEach(t=>{t.extInfo=e.find(e=>(null==e?void 0:e.id)==t.supplierId),this._setFewVotesText(t.extInfo)})}return s.map(t=>new e(t))},l.getProductSupplierByNmIdsAsync=async function(t){const s=i.getSuppliersFromCache(),l=t.filter(e=>null==s[e]);let r={};return l.length>0&&(this.suppliersList||(this.suppliersList=await this._getMultishopSuppliers()),(r=await Promise.all(l.map(e=>this._loadBasicSupplierInfoAsync(e,this.suppliersList)))).forEach(e=>null!=e&&(s[e.nmId]=e))),i.setSuppliersToCache(Object.values(s)),Object.entries(s).reduce((t,[i,s])=>(t[i]=new e(s),t),{})},l.loadBasicSupplierInfoAsync=async function(e){return this.suppliersList||(this.suppliersList=await this._getMultishopSuppliers()),await this._loadBasicSupplierInfoAsync(e,this.suppliersList)},l._loadBasicSupplierInfoAsync=async function(t,i){try{const s=await this.$httpClient.fetchBasicJSON(wb.helpers.url.urlSellerStatic(t),{},{nullOnError:!0});if(null==s)return null;const l=await this._getMultiShopInfo(s.supplierId,t,i);return l&&(s.shopName=l.title,s.logoUrl=l.logo_url,s.shopId=l.num),new e(s)}catch(e){return console.error(e),null}},l.getSupplierExtInfo=function(e,t){var i,s;if(32477==e||12399==e)return null;if(!(null!==(i=wb.global.settings)&&void 0!==i&&null!==(i=i.switches)&&void 0!==i&&i.enableSellerPercent&&e>0))return null;const l=null===(s=wb.global.settings)||void 0===s||null===(s=s.switches)||void 0===s?void 0:s.enablePublicSellerPercent;return this._getSupplierInfo(e,l,t)},l.getSuppliersExtInfo=async function(e){var i,s,l;if(e&&0!=e.length){if(e=this._removeSuppliersIds(e),null===(i=wb.global.settings)||void 0===i||null===(i=i.switches)||void 0===i||!i.enableSellerPercent||0==e.length)return null;if(null!==(s=wb.global.settings)&&void 0!==s&&null!==(s=s.switches)&&void 0!==s&&s.enablePublicSellerPercent)return this._getListFromPublic(e);if(null!==(l=wb.global.settings)&&void 0!==l&&null!==(l=l.switches)&&void 0!==l&&l.enableSellerPercent&&0!=e.length){const i=await this.$httpClient.fetchJSON("webapi/spa/product/getsellersinfo?"+e.reduce((e,t)=>(e.append("supplierIds",t),e),new URLSearchParams));return i?i.map(e=>new t(e)):null}return null}},l._removeSuppliersIds=function(e){const t=Array.from(e);return[32477,12399].forEach(e=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)}),t},l._getSupplierInfo=async function(e,t,i){const s=[];s.push(t?this._getFromPublic(e):this._getFromInner(e)),i&&s.push(this._loadDeliveryInfoFromProductAsync(i));const[l,r]=await Promise.all(s);return null!=l&&l.deliveryDuration&&r&&(r.deliveryTime=l.deliveryDuration,l.deliveryInfo=r),this._setFewVotesText(l),l},l._getMultiShopInfo=async function(e,t,i){if(!t||!e)return Promise.resolve();if((null==i?void 0:i.length)>0&&i.find(t=>t.supplier_id==e)){const i=await this.$httpClient.fetchJSON(`/webapi/multishopsupplierinfo/${e}/${t}`);return i&&(i.supplierId=e,i.nmId=t),Promise.resolve(i)}return Promise.resolve(null)},l._getMultishopSuppliers=async function(){const e=i.getMultishopSuppliersFromCache();if(e)return Promise.resolve(e);try{const e=await this.$httpClient.fetchJSON("/webapi/seller/multishopsupplier-list",{},{noProcessResponse:!0});return i.setMultishopSuppliersToCache(null==e?void 0:e.value),Promise.resolve(null==e?void 0:e.value)}catch(e){return Promise.resolve(null)}},l._getFromInner=async function(e){const i=await this.$httpClient.fetchJSON(this.$router.urls.productCardSupplierPercent+e);return i?new t(i):null},l._getFromPublic=async function(e){const s=i.getExtFromCache(e);if(s)return 1==s.e?null:s;const l=await fetch("https://suppliers-shipment.wildberries.ru/api/v1/suppliers/"+e,{headers:{"X-Client-Name":"site"}});if(!l.ok)return 404==l.status&&i.setExtToCache(e,{e:1}),null;const r=await l.json();if(Object.keys(null!=r?r:{}).length>0){const s=new t(r);return i.setExtToCache(e,s),s}return null},l._getListFromPublic=async function(e){const{result:s,uncachedList:l}=e.reduce((e,t)=>{const s=i.getExtFromCache(t);return e.result.set(t,s),!s&&e.uncachedList.push(t),e},{result:new Map,uncachedList:[]});if(0==l.length)return s.toArray(e=>1==e.e?null:e);try{const e=await fetch("https://suppliers-shipment.wildberries.ru/api/v1/suppliers/find_by_ids",{headers:{"X-Client-Name":"site","Content-Type":"application/json"},method:"POST",body:JSON.stringify(l)}),r=(await e.json()).toMap(e=>e.id,e=>e);l.forEach(e=>{const l=r.has(e)?new t(r.get(e)):{e:1};s.set(e,l),i.setExtToCache(e,l)})}catch(e){console.error(e)}finally{return s.toArray(e=>1==e.e?null:e)}},l._loadDeliveryInfoFromProductAsync=async function(e){try{if(!e.storeId)return null;await this.$moduleLoader.loadServiceAsync("deliveryInfoService");const t=await this.$services.deliveryInfoService.getStoreById(e.storeId);return t.isSellerStore?{isSellerDelivery:t.isDbs,deliveryTime:null}:null}catch(e){return null}},l._setFewVotesText=function(e){e||(e={}),e.feedbacks?e.feedbacks<5&&(e.fewVotesText="Мало оценок"):e.fewVotesText="Нет оценок"},s}();window.__spaServiceManager__.register("suppliersService",s)}();

},{"./supplierExtInfo":1,"./supplierInfo":2,"./supplierInfoCache":3}]},{},[4]);
